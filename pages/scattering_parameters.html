
<!DOCTYPE html>

<html data-content_root="" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>Scattering parameters — CamachoLab Photonics Bootcamp</title>
<script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
<!-- Loaded before other Sphinx assets -->
<link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" rel="preload" type="font/woff2"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" rel="stylesheet" type="text/css"/>
<link href="../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
<link href="../_static/copybutton.css" rel="stylesheet" type="text/css"/>
<link href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
<link href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" rel="preload"/>
<link as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" rel="preload"/>
<script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/clipboard.min.js"></script>
<script src="../_static/copybutton.js"></script>
<script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
<script>let toggleHintShow = 'Click to show';</script>
<script>let toggleHintHide = 'Click to hide';</script>
<script>let toggleOpenOnPrint = 'true';</script>
<script src="../_static/togglebutton.js"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
<script src="../_static/design-tabs.js"></script>
<script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
<script async="async" src="../_static/sphinx-thebe.js"></script>
<script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
<script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>DOCUMENTATION_OPTIONS.pagename = 'pages/scattering_parameters';</script>
<link href="https://byucamacholab.github.io/Photonics-Bootcamp/pages/scattering_parameters.html" rel="canonical"/>
<link href="../_static/favicon-laser.svg" rel="shortcut icon"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="drc.html" rel="next" title="Design rule checks"/>
<link href="compact_models.html" rel="prev" title="Compact models"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
<link href="../_static/styles/chattutor.style.css" rel="stylesheet" type="text/css"/></head>
<body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-default-mode="" data-offset="180">
<a class="skip-link" href="#main-content" id="pst-skip-link">Skip to main content</a>
<div id="pst-scroll-pixel-helper"></div>
<button class="btn rounded-pill" id="pst-back-to-top" type="button">
<i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>
<input class="sidebar-toggle" id="__primary" name="__primary" type="checkbox"/>
<label class="overlay overlay-primary" for="__primary"></label>
<input class="sidebar-toggle" id="__secondary" name="__secondary" type="checkbox"/>
<label class="overlay overlay-secondary" for="__secondary"></label>
<div class="search-button__wrapper">
<div class="search-button__overlay"></div>
<div class="search-button__search-container">
<form action="../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search this book..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
</div>
<header class="bd-header navbar navbar-expand-lg bd-navbar">
</header>
<div class="bd-container">
<div class="bd-container__inner bd-page-width">
<div class="bd-sidebar-primary bd-sidebar">
<div class="sidebar-header-items sidebar-primary__section">
</div>
<div class="sidebar-primary-items__start sidebar-primary__section">
<div class="sidebar-primary-item">
<a class="navbar-brand logo" href="../index.html">
<img alt="CamachoLab Photonics Bootcamp - Home" class="logo__image only-light" src="../_static/logo.png"/>
<script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="CamachoLab Photonics Bootcamp - Home"/>`);</script>
</a></div>
<div class="sidebar-primary-item"><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item navbar-nav active">
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Front Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development Environment</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="open_source.html">Open source software</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="software.html">Software</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="wsl.html">WSL (Windows-only)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vscode.html">Visual Studio Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="git_and_github.html">Git (and GitHub)</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="klayout.html">KLayout</a></li>
<li class="toctree-l2"><a class="reference internal" href="laboratory_tools.html">Laboratory Tools</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Passive Device Design and Simulation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="photonic_devices.html">What are photonic devices?</a></li>
<li class="toctree-l1"><a class="reference internal" href="layer_stack.html">Defining the layer stack</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="components.html">Components</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="gds_to_meep.html">GDS to Meep</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="waveguides.html">Waveguides</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="waveguides_tir.html">Total Internal Reflection</a></li>
<li class="toctree-l2"><a class="reference internal" href="waveguides_polarization.html">Polarization</a></li>
<li class="toctree-l2"><a class="reference internal" href="ray_optic_model.html">Improving the Ray-optic Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="waveguides_modelling.html">Modelling Wavegudies</a></li>
<li class="toctree-l2"><a class="reference internal" href="waveguides_mode_solvers.html">Waveguide modes</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="passive_components.html">Passive Components</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="directional_couplers.html">Directional couplers</a></li>
<li class="toctree-l2"><a class="reference internal" href="y_branch.html">Y-Branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="ring_resonators.html">Ring Resonators</a></li>
<li class="toctree-l2"><a class="reference internal" href="mmis.html">Multimode Interferometers (MMIs)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="optical_io.html">Optical I/O</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="grating_couplers.html">Grating couplers</a></li>
<li class="toctree-l2"><a class="reference internal" href="edge_couplers.html">Edge couplers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="optimization.html">Optimization and inverse design</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="shape_optimization.html">Shape optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="adjoint_optimization.html">Adjoint optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="meep_to_gds.html">Meep to GDS</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="compact_models.html">Compact models</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Scattering parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="drc.html">Design rule checks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Circuit Design and Simulation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pdks.html">Process design kits</a></li>
<li class="toctree-l1"><a class="reference internal" href="mzi.html">Mach-Zehnder interferometers</a></li>
<li class="toctree-l1"><a class="reference internal" href="mzi_layout.html">Laying out a Mach-Zehnder Interferometer</a></li>
<li class="toctree-l1"><a class="reference internal" href="layout_demo.html">Layout Demo</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Active Device Design and Simulation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="advanced_components.html">Advanced Components</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="phase_shifters.html">Phase Shifters</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="phase_shifters_heaters.html">Heaters</a></li>
<li class="toctree-l2"><a class="reference internal" href="phase_shifters_pn.html">PN and PIN Junctions</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Testing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="analyzing_circuits.html">Analyzing circuits</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/BYUCamachoLab/sky130ph">Repository</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/BYUCamachoLab/sky130ph/docs">PDK Documentation</a></li>
</ul>
</div>
</nav></div>
</div>
<div class="sidebar-primary-items__end sidebar-primary__section">
</div>
<div id="rtd-footer-container"></div>
</div>
<main class="bd-main" id="main-content">
<div class="sbt-scroll-pixel-helper"></div>
<div class="bd-content">
<div class="bd-article-container">
<div class="bd-header-article">
<div class="header-article-items header-article__inner">
<div class="header-article-items__start">
<div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" data-bs-placement="bottom" data-bs-toggle="tooltip" for="__primary" title="Toggle primary sidebar">
<span class="fa-solid fa-bars"></span>
</label></div>
</div>
<div class="header-article-items__end">
<div class="header-article-item">
<div class="article-header-buttons">
<div class="dropdown dropdown-launch-buttons">
<button aria-expanded="false" aria-label="Launch interactive content" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fas fa-rocket"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://mybinder.org/v2/gh/BYUCamachoLab/Photonics-Bootcamp/main?urlpath=tree/book/pages/scattering_parameters.ipynb" target="_blank" title="Launch onBinder">
<span class="btn__icon-container">
<img src="../_static/images/logo_binder.svg"/>
</span>
<span class="btn__text-container">Binder</span>
</a>
</li>
<li><a class="btn btn-sm dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://colab.research.google.com/github/BYUCamachoLab/Photonics-Bootcamp/blob/main/book/pages/scattering_parameters.ipynb" target="_blank" title="Launch onColab">
<span class="btn__icon-container">
<img src="../_static/images/logo_colab.png"/>
</span>
<span class="btn__text-container">Colab</span>
</a>
</li>
</ul>
</div>
<div class="dropdown dropdown-source-buttons">
<button aria-expanded="false" aria-label="Source repositories" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fab fa-github"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm btn-source-repository-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://github.com/BYUCamachoLab/Photonics-Bootcamp" target="_blank" title="Source repository">
<span class="btn__icon-container">
<i class="fab fa-github"></i>
</span>
<span class="btn__text-container">Repository</span>
</a>
</li>
<li><a class="btn btn-sm btn-source-edit-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://github.com/BYUCamachoLab/Photonics-Bootcamp/edit/main/book/pages/scattering_parameters.ipynb" target="_blank" title="Suggest edit">
<span class="btn__icon-container">
<i class="fas fa-pencil-alt"></i>
</span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
<li><a class="btn btn-sm btn-source-issues-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://github.com/BYUCamachoLab/Photonics-Bootcamp/issues/new?title=Issue%20on%20page%20%2Fpages/scattering_parameters.html&amp;body=Your%20issue%20content%20here." target="_blank" title="Open an issue">
<span class="btn__icon-container">
<i class="fas fa-lightbulb"></i>
</span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
</ul>
</div>
<div class="dropdown dropdown-download-buttons">
<button aria-expanded="false" aria-label="Download this page" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fas fa-download"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm btn-download-source-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="../_sources/pages/scattering_parameters.ipynb" target="_blank" title="Download source file">
<span class="btn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
<li>
<button class="btn btn-sm btn-download-pdf-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" onclick="window.print()" title="Print to PDF">
<span class="btn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
<button class="btn btn-sm btn-fullscreen-button" data-bs-placement="bottom" data-bs-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="btn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" data-bs-placement="bottom" data-bs-toggle="tooltip" for="__secondary" title="Toggle secondary sidebar">
<span class="fa-solid fa-list"></span>
</label>
</div></div>
</div>
</div>
</div>
<div class="onlyprint" id="jb-print-docs-body">
<h1>Scattering parameters</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-scattering-parameters">What are scattering parameters?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-are-s-parameters-useful">Why are S-Parameters useful?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation">How to find S-Parameters for an arbitrary device using a meep simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-import-geometry">Step 1 - Import Geometry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-run-simulation-for-a-single-source">Step 2: Run simulation for a single source</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-run-the-same-simulation-for-each-port">Step 3: Run the same simulation for each port</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-parameters-across-different-frequencies">S-Parameters across different Frequencies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-gplugins-gmeep-write-sparameters-meep">Using <code class="docutils literal notranslate"><span class="pre">gplugins.gmeep.write_sparameters_meep</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</nav>
</div>
</div>
</div>
<div id="searchbox"></div>
<article class="bd-article">
<section class="tex2jax_ignore mathjax_ignore" id="scattering-parameters">
<h1>Scattering parameters<a class="headerlink" href="#scattering-parameters" title="Permalink to this heading">#</a></h1>
<section id="what-are-scattering-parameters">
<h2>What are scattering parameters?<a class="headerlink" href="#what-are-scattering-parameters" title="Permalink to this heading">#</a></h2>
<p>For a given photonic device, while knowing the actual shape of the device is useful, what we really care about is how light propagates through it. Scattering parameters (S-parameters) are complex numbers that represent the magnitude and phase multiplier acting on the light between every port in a device. S-parameters are collected into an s-matrix which then represents the complete 1st order (linear) input-output response of the device.</p>
<p>For a device with N ports, there will be N<sup>2</sup> parameters. The notation for S-Matrices is S<sub>(output port)(input port)</sub>, so S<sub>13</sub> will be for the light entering port 3 and exiting port 1. Parameters with the input and output port represent reflections from the device back into the same port, while different output and input ports represent the transmission from the input port into the output ports.</p>
<p>It is easiest to represent s-parameters in polar coordinate form.</p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">#</a></h3>
<p>A device has the s-parameter <span class="math notranslate nohighlight">\(S_{21} = 0.98 e^{j\frac{\pi}{2}}\)</span>. This means the light accumulates <span class="math notranslate nohighlight">\(90^\circ\)</span> of phase, and its intensity/power will be 96% (<span class="math notranslate nohighlight">\(0.98^2 = 0.9604\)</span>) of the input when we measure the output on port 2 and put input light in port 1.</p>
</section>
</section>
<section id="why-are-s-parameters-useful">
<h2>Why are S-Parameters useful?<a class="headerlink" href="#why-are-s-parameters-useful" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>S-parameters allow us to represent a potentially complex photonic component as a matrix, which is much simpler to store and use in computation than other options (e.g. nonlinear functions, FDTD simulations, etc.).</p></li>
<li><p>It allows us to connect the device arbitrarily to other components and simulate its behavior in any photonic circuit.</p></li>
<li><p>Wavelength dependence (dispersion) can be represented simply by adding an extra dimension to the s-matrix.</p></li>
</ul>
<p>S-Parameters are used in circuit-level simulation software, e.g. simphony, sax, Lumerical Interconnect, etc.</p>
</section>
<section id="how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation">
<h2>How to find S-Parameters for an arbitrary device using a meep simulation<a class="headerlink" href="#how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation" title="Permalink to this heading">#</a></h2>
<p>In this section we’ll demonstrate how to find the s-params for any device using a meep simulation. We’ll show both 2D and 3D simulations, but keep in mind that 2D s-params are not very accurate, but the simulations run much faster. It is often recommended to set up the simulation in 2D to ensure everything works, then extend the simulation into 3D to run the final simulations. This can save us a lot of debugging time since the 2D simulations run faster.</p>
<p>We’ll run through the steps using gdsfactory’s default 2x2 mmi, and explain on the way how the principles can be applied to any component. There are other ways to find s-parameters, one such method is shown on the <a class="reference internal" href="gds_to_meep.html"><span class="doc std std-doc">Gds To Meep</span></a> page.</p>
<section id="step-1-import-geometry">
<h3>Step 1 - Import Geometry<a class="headerlink" href="#step-1-import-geometry" title="Permalink to this heading">#</a></h3>
<p>This tutorial is adapted from the <a class="reference external" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/GDSII_Import/">GDSII Import</a> tutorial.</p>
<p>If we have a gds of the device whose parameters we want to simulate, we can add all of our sources and detectors into our gds before we import it into meep. This will create the sources and monitors in meep that we need for the simulation.</p>
<p>Here is a picture of the gds we will be using.</p>
<p><img alt="Image of splitter file" src="https://raw.githubusercontent.com/BYUCamachoLab/Photonics-Bootcamp/main/book/images/Notebook_Images/mmi2x2_gds_with_ports.png"/></p>
<p>We add a box around the entire component (purple) which will become the simulation region, and 8 lines, 2 on each end that will become the sources and detectors. We also add straight waveguides on the ports of the gdsfactory mmi so that the ports will be exactly where the light would enter and exit the component in an actual circuit.</p>
<p>So, now that we have a gds, lets import it into meep!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">meep</span> <span class="k">as</span> <span class="nn">mp</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">gplugins.gmeep.get_meep_geometry</span> <span class="kn">import</span> <span class="n">get_meep_geometry_from_component</span>
<span class="kn">from</span> <span class="nn">gdsfactory.read</span> <span class="kn">import</span> <span class="n">import_gds</span>
<span class="kn">import</span> <span class="nn">gdsfactory</span> <span class="k">as</span> <span class="nn">gf</span>
<span class="n">mp</span><span class="o">.</span><span class="n">verbosity</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next we’ll define a whole bunch of variables so our code is more readable down the line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="mi">40</span> <span class="c1"># the resolution of the simulation in pixels/um</span>
<span class="n">sim_is_3D</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Turn this to false for a 2D simulation</span>

<span class="n">pwd</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">''</span><span class="p">))</span>
<span class="n">gds_file</span> <span class="o">=</span> <span class="n">pwd</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">"files/mmi2x2.gds"</span> <span class="c1"># The name of our gds file</span>

<span class="c1"># The Parameters for the frequencies we'll be using</span>
<span class="n">lcen</span> <span class="o">=</span> <span class="mf">1.55</span> <span class="c1"># Center wavelength</span>
<span class="n">fcen</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">lcen</span> <span class="c1"># Center frequency</span>
<span class="n">df</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">fcen</span> <span class="c1"># Frequency Diameter</span>

<span class="c1"># The thickness of each material in our simulation (only used in 3D simulations)</span>
<span class="n">t_oxide</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">t_Si</span> <span class="o">=</span> <span class="mf">0.22</span>
<span class="n">t_air</span> <span class="o">=</span> <span class="mf">0.78</span>

<span class="n">dpml</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Diameter of perfectly matched layers</span>
<span class="n">cell_thickness</span> <span class="o">=</span> <span class="n">dpml</span> <span class="o">+</span> <span class="n">t_oxide</span> <span class="o">+</span> <span class="n">t_Si</span> <span class="o">+</span> <span class="n">t_air</span> <span class="o">+</span> <span class="n">dpml</span> <span class="c1"># Cell thickness</span>

<span class="c1"># Materials used in the simulation</span>
<span class="n">Si</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mf">3.45</span><span class="p">)</span>
<span class="n">SiO2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mf">1.444</span><span class="p">)</span>

<span class="c1"># Sets the min and max values for the cell and the silicon. Our simulation will be centered at y=0</span>
<span class="n">cell_zmax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">cell_thickness</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="mi">0</span>
<span class="n">cell_zmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">cell_thickness</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># Create a 2D array to hold the S-Parameters for the device</span>
<span class="n">n_ports</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># The number of ports, also the size of our array</span>
<span class="n">s_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_ports</span><span class="p">,</span> <span class="n">n_ports</span><span class="p">))</span>

<span class="n">mode_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we’ll import our geometry from the gds file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gdsfactory.technology</span> <span class="kn">import</span> <span class="n">LayerLevel</span><span class="p">,</span> <span class="n">LayerStack</span>
<span class="n">layers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">core</span><span class="o">=</span><span class="n">LayerLevel</span><span class="p">(</span>
            <span class="n">layer</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">thickness</span><span class="o">=</span><span class="n">t_Si</span><span class="p">,</span>
            <span class="n">zmin</span><span class="o">=-</span><span class="n">t_Si</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">material</span><span class="o">=</span><span class="s2">"si"</span><span class="p">,</span>
            <span class="n">mesh_order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">sidewall_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">width_to_z</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="s2">"100"</span><span class="p">,)</span>
              <span class="p">)</span>
<span class="n">layer_stack</span> <span class="o">=</span> <span class="n">LayerStack</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="p">)</span>

<span class="n">mmi_comp</span> <span class="o">=</span> <span class="n">import_gds</span><span class="p">(</span><span class="n">gds_file</span><span class="p">)</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="n">get_meep_geometry_from_component</span><span class="p">(</span><span class="n">mmi_comp</span><span class="p">,</span> <span class="n">is_3d</span><span class="o">=</span><span class="n">sim_is_3D</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">lcen</span><span class="p">,</span> <span class="n">layer_stack</span><span class="o">=</span><span class="n">layer_stack</span><span class="p">)</span>
<span class="c1"># Use this to modify the material of the loaded geometry if needed.</span>
<span class="c1"># geometry = [mp.Prism(geom.vertices, geom.height, geom.axis, geom.center, material=mp.Medium(index=3.45)) for geom in geometry]</span>
<span class="n">mmi_comp</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ###################################################</span>
<span class="c1"># Now we actually import the geometry</span>
<span class="n">cell_x</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">cell_y</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">cell_z</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">port_xsize</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">port_ysize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">port_zsize</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">port_xdisp</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">port_ydisp</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.75</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

<span class="n">port_size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">port_xsize</span><span class="p">,</span> <span class="n">port_ysize</span><span class="p">,</span> <span class="n">port_zsize</span><span class="p">)</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">port_xsize</span><span class="p">,</span> <span class="n">port_ysize</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">cell_x</span><span class="p">,</span> <span class="n">cell_y</span><span class="p">,</span> <span class="n">cell_z</span><span class="p">)</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">cell_x</span><span class="p">,</span> <span class="n">cell_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">port1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="n">port_xdisp</span><span class="p">,</span><span class="o">-</span><span class="n">port_ydisp</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">port_size</span><span class="p">)</span>
<span class="n">port2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="n">port_xdisp</span><span class="p">,</span><span class="n">port_ydisp</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">port_size</span><span class="p">)</span>
<span class="n">port3</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">port_xdisp</span><span class="p">,</span><span class="o">-</span><span class="n">port_ydisp</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">port_size</span><span class="p">)</span>
<span class="n">port4</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">port_xdisp</span><span class="p">,</span><span class="n">port_ydisp</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">port_size</span><span class="p">)</span>
<span class="n">source1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">port1</span><span class="o">.</span><span class="n">center</span><span class="o">-</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="n">port_size</span><span class="p">)</span>
<span class="n">source2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">port4</span><span class="o">.</span><span class="n">center</span><span class="o">+</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">port_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2-run-simulation-for-a-single-source">
<h3>Step 2: Run simulation for a single source<a class="headerlink" href="#step-2-run-simulation-for-a-single-source" title="Permalink to this heading">#</a></h3>
<p>In order to find all the S-Parameters for a device, we have to run a number of simulations where we set the source to be in one of the four ports and then record the output field in all ports. Normally we would have to do this as many times as number of ports, setting a different one to be the input in each time, and we will demonstrate how we can do this in this notebook.</p>
<p>Note, however, that the MMI we are using has mirror symmetry about both the x and y axes, which means we could just do the simulation once and then assign the s-parameters using symmetry arguments. This is a useful trick when working with devices with symmetries about the ports that can save a lot of time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the first source for the simulation in port 1 (lower left).</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">volume</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mode_parity</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Create Simulation</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="c1"># The resolution, defined further up</span>
    <span class="n">cell_size</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="c1"># The simulation size, taken from the gds</span>
    <span class="n">boundary_layers</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">dpml</span><span class="p">)],</span> <span class="c1"># the boundary layers to absorb fields that leave the simulation</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="n">sources</span><span class="p">,</span> <span class="c1"># The sources</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">,</span> <span class="c1"># The geometry</span>
    <span class="n">default_material</span><span class="o">=</span><span class="n">SiO2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>After creating the simulation, we can add mode monitors at each of the ports. These will collect the fields on each port and accumulate the fourier transform of the time-domain fields, giving us frequency-domain field information at the end.</p>
<p>After our simulation is completely set up for the first source, we can plot it to make sure everything looks right before running the simulation. We do that using the plot2D() method.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adds mode monitors at each of the ports to track the energy that goes in or out</span>

<span class="n">mode_monitor_1</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port1</span><span class="p">))</span>
<span class="n">mode_monitor_2</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port2</span><span class="p">))</span>
<span class="n">mode_monitor_3</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port3</span><span class="p">))</span>
<span class="n">mode_monitor_4</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port4</span><span class="p">))</span>

<span class="c1"># Plot the simulation</span>
<span class="n">plot_plane</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cell</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">sim</span><span class="o">.</span><span class="n">plot2D</span><span class="p">(</span><span class="n">output_plane</span><span class="o">=</span><span class="n">plot_plane</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># No parameters are needed for a 2D simulation. </span>
</pre></div>
</div>
</div>
</div>
<p>As we see from the output of sim.plot2D, our simulation is set up correctly. The red line is our source, the blue are our 4 monitors. We are ready to run the simulation! Actually running the simulation is the most computationally intense part of this, so it may take some time if you have a high resolution and are running a 3D simulation. The <code class="docutils literal notranslate"><span class="pre">until_after_sources=mp.stop_when_dft_decayed</span></code> parameter for sim.run() means meep will start checking how much the cumulative Fourier Transform of all the fields in the simulation changes only after the sources have turned off. Then, it will wait until the DFT’s change over one time step is below a certain threshold (1e-11 relative change by default), at which point it will stop the simulation</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Runs the simulation</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until_after_sources</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">stop_when_dft_decayed</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that our simulation has been run, the monitors contain the s-parameters which we can retrieve. The function sim.get_eigenmode_coefficients() returns an array that holds the parameters for every mode, every frequency, and in the forward and backward direction. In our simulation we only simulated the fundamental TE mode and at only our center frequency. For most applications, only the fundamental TE mode matters, but often we do want to see how the S-parameters change with frequency. To do that, simply change the df and nfreq parameters for the mode monitors. However, in our simulation we do care about the direction. In our simulation, light will go in port 1 going forward (towards positive X) and exit ports 3 and 4 in the same direction, but any light exiting port 1 and 2 will be going backwards (towards negative X). Therefore, we retrieve the index [0,0,1] for port 1 and 2 which is the index for backward propagating mode.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Finds the S parameters</span>
<span class="n">norm_mode_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">mode_monitor_1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mode_parity</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">port1_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">mode_monitor_1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mode_parity</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm_mode_coeff</span>
<span class="n">port2_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">mode_monitor_2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mode_parity</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm_mode_coeff</span>
<span class="n">port3_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">mode_monitor_3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mode_parity</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm_mode_coeff</span>
<span class="n">port4_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">mode_monitor_4</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mode_parity</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm_mode_coeff</span>
<span class="c1"># Store the S parameters in s_params</span>
<span class="n">s_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">port1_coeff</span><span class="p">,</span> <span class="n">port2_coeff</span><span class="p">,</span> <span class="n">port3_coeff</span><span class="p">,</span> <span class="n">port4_coeff</span><span class="p">]</span>


<span class="c1"># Prints out the S parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Normalized s-params:</span><span class="se">\n</span><span class="s2">Port1(Lower Left, S11): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">port1_coeff</span><span class="p">)</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">port1_coeff</span><span class="p">)</span><span class="si">}</span><span class="s2"> deg  </span><span class="se">\n</span><span class="s2">Port2(Upper Left, S12): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">port2_coeff</span><span class="p">)</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">port2_coeff</span><span class="p">)</span><span class="si">}</span><span class="s2"> deg  </span><span class="se">\n</span><span class="s2">Port3(Upper Right, S13): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">port3_coeff</span><span class="p">)</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">port3_coeff</span><span class="p">)</span><span class="si">}</span><span class="s2"> deg  </span><span class="se">\n</span><span class="s2">Port4(Lower Right, S14): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">port4_coeff</span><span class="p">)</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">port4_coeff</span><span class="p">)</span><span class="si">}</span><span class="s2"> deg"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll also compute and print the transmittance through each port and the total insertion loss. We won’t do this with the other ports as inputs, but it’s a good exercise here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculates the transmittance based off of the S parameters</span>
<span class="n">port1_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port1_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">port2_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port2_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">port3_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port3_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">port4_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port4_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="c1"># Calculates the Insertion loss as a percent and in dB</span>
<span class="n">insertionLoss</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">port2_trans</span> <span class="o">+</span> <span class="n">port3_trans</span> <span class="o">+</span> <span class="n">port4_trans</span><span class="p">)</span>
<span class="n">insertionLoss_dB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">insertionLoss</span><span class="p">)</span> 

<span class="c1"># Prints the Transmittance</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Transmittance/Reflectance: Port1: </span><span class="si">{</span><span class="n">port1_trans</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">% Port2: </span><span class="si">{</span><span class="n">port2_trans</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%, Port3: </span><span class="si">{</span><span class="n">port3_trans</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%, Port4: </span><span class="si">{</span><span class="n">port4_trans</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Insertion Loss: </span><span class="si">{</span><span class="n">insertionLoss</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">% = </span><span class="si">{</span><span class="n">insertionLoss_dB</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">db"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We find that this component is actually terrible and would never be used in an actual photonic design. Over a third of the light is lost, and the light that isn’t lost is not split in any specific ratio. Fortunately, it was never meant to be used, and just exists as an example of the basic shape of an mmi.</p>
<p>Finally, before we move on to the next step, we’ll run the simulation again and create a plot of the steady state of the mmi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reset the simulation in order to run it again and visulaize the fields</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reset_meep</span><span class="p">()</span>

<span class="c1"># Create a continuous source</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
        <span class="n">src</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">ContinuousSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
        <span class="n">volume</span><span class="o">=</span><span class="n">port1</span><span class="p">,</span>
        <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
        <span class="n">eig_match_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Sets up the simulation again</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
    <span class="n">cell_size</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span>
    <span class="n">boundary_layers</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">dpml</span><span class="p">)],</span>
    <span class="n">sources</span><span class="o">=</span><span class="n">sources</span><span class="p">,</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Runs the simulation for a long time to ensure that the fields have reached a steady state</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

<span class="c1"># Gets data</span>
<span class="n">eps_data</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">()</span> <span class="c1"># Epsilon Data / The Geometry / An array that holds what materials are where</span>
<span class="n">ez_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">get_efield_z</span><span class="p">())</span> <span class="c1"># Values for the component of the E-field in the z direction (in/out of screen)</span>

<span class="c1"># Creates the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">eps_data</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">"spline36"</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"binary"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ez_data</span><span class="p">)),</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s2">"spline36"</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">"RdBu"</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">"off"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-3-run-the-same-simulation-for-each-port">
<h3>Step 3: Run the same simulation for each port<a class="headerlink" href="#step-3-run-the-same-simulation-for-each-port" title="Permalink to this heading">#</a></h3>
<p>Now, all that’s left to do is to run the simulation for each source. Here, I’ll use a for loop to run the other three simulations. We could have done this for all four, but hopefully this makes the code make more sense.</p>
<p>For the sources going into port 3 and 4, we have to specify that the light will be propagating backwards. Below, I’ve done this by setting the direction to mp.NO_DIRECTION and using the eig_kpoint parameter to specify the direction. You can use this same method to launch sources in any direction.</p>
<p>It should be noted, that since the 2x2 mmi we are using is symmetrical across both the x and y axies, the S-parameters should be the same for all of the other ports. But for the sake of demonstration, we’ll simulate all of them. Then at then end we can check to see the the S-parameters are actually the same.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the rest of the sources for the simulation.</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">port1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">port1</span><span class="o">.</span><span class="n">center</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">port2</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">port2</span><span class="o">.</span><span class="n">center</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">port3</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">port3</span><span class="o">.</span><span class="n">center</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">eig_kpoint</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_DIRECTION</span>
        <span class="p">),</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">port4</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">port4</span><span class="o">.</span><span class="n">center</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">eig_kpoint</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_DIRECTION</span>
        <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_ports</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">sources</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">sim</span><span class="o">.</span><span class="n">reset_meep</span><span class="p">()</span> <span class="c1"># resets everything</span>

    <span class="c1"># Create Simulation</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="c1"># The resolution, defined further up</span>
    <span class="n">cell_size</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="c1"># The cell size, taken from the gds</span>
    <span class="n">boundary_layers</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">dpml</span><span class="p">)],</span> <span class="c1"># the perfectly matched layers, with a diameter as defined above</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">],</span> <span class="c1"># The source(s) we just defined</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="c1"># The geometry, from above</span>
    <span class="p">)</span>
    
    <span class="c1"># Adds mode monitors at each of the ports to track the energy that goes in or out</span>
    <span class="n">mode_monitor_1</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port1</span><span class="p">))</span>
    <span class="n">mode_monitor_2</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port2</span><span class="p">))</span>
    <span class="n">mode_monitor_3</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port3</span><span class="p">))</span>
    <span class="n">mode_monitor_4</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port4</span><span class="p">))</span>

    <span class="c1"># Runs the simulation</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until_after_sources</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">stop_when_dft_decayed</span><span class="p">)</span>

    <span class="c1">#############################################################</span>
    <span class="c1"># Finds the S parameters</span>
    <span class="n">mode_monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode_monitor_1</span><span class="p">,</span> <span class="n">mode_monitor_2</span><span class="p">,</span> <span class="n">mode_monitor_3</span><span class="p">,</span> <span class="n">mode_monitor_4</span><span class="p">]</span>
    <span class="n">norm_mode</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">mode_monitors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mode_parity</span><span class="p">)</span>
    <span class="n">norm_mode_coeff</span> <span class="o">=</span> <span class="n">norm_mode</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">norm_mode</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">port1_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">mode_monitor_1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mode_parity</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm_mode_coeff</span>
    <span class="n">port2_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">mode_monitor_2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mode_parity</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm_mode_coeff</span>
    <span class="n">port3_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">mode_monitor_3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mode_parity</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm_mode_coeff</span>
    <span class="n">port4_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">mode_monitor_4</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mode_parity</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm_mode_coeff</span> <span class="c1"># This is the total amount of light that entered the devie</span>

    <span class="c1"># Store the S parameters in s_params</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">s_params</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">port1_coeff</span><span class="p">,</span> <span class="n">port2_coeff</span><span class="p">,</span> <span class="n">port3_coeff</span><span class="p">,</span> <span class="n">port4_coeff</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"S-Params:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_ports</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">1: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\t</span><span class="s2">S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">2: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\t</span><span class="s2">S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">3: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\t</span><span class="s2">S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">4: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Transmission:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_ports</span><span class="p">):</span>
    <span class="n">trans1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">trans2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">trans3</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">trans4</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">trans1</span><span class="si">:</span><span class="s2">.6</span><span class="si">}</span><span class="s2"> %</span><span class="se">\t</span><span class="si">{</span><span class="n">trans2</span><span class="si">:</span><span class="s2">.6</span><span class="si">}</span><span class="s2"> %</span><span class="se">\t</span><span class="si">{</span><span class="n">trans3</span><span class="si">:</span><span class="s2">.6</span><span class="si">}</span><span class="s2"> %</span><span class="se">\t</span><span class="si">{</span><span class="n">trans4</span><span class="si">:</span><span class="s2">.6</span><span class="si">}</span><span class="s2"> %"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Above, we can see all of the S-parameters from the simulations, and we can verify that the S-parameters are in fact the same for every port, which is what we expected. We also calculated the transmission which is also the same no matter what port we use.</p>
</section>
<section id="s-parameters-across-different-frequencies">
<h3>S-Parameters across different Frequencies<a class="headerlink" href="#s-parameters-across-different-frequencies" title="Permalink to this heading">#</a></h3>
<p>For most applications, you’ll want to know the S-parameters across a range of frequencies. This can be done using the simulations created here. When we get the S-parameters using the sim.get_eigenmode_coefficients().alpha[] we get a matrix. The first entry in the matrix specifies the wavelength. For brevity’s sake, we won’t show that here, but a good exercise would be to find and plot the s-paramters across a range of frequencies for the component shown here.</p>
<p>Multiple frequencies can be simulated at once by setting the second and third arguments in the mode monitors to the desired frequency width and number of points, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">n_freq_points</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="using-gplugins-gmeep-write-sparameters-meep">
<h2>Using <code class="docutils literal notranslate"><span class="pre">gplugins.gmeep.write_sparameters_meep</span></code><a class="headerlink" href="#using-gplugins-gmeep-write-sparameters-meep" title="Permalink to this heading">#</a></h2>
<p>An alternative method to the one outlined above is using the gplugins package. The <code class="docutils literal notranslate"><span class="pre">write_sparameters_meep</span></code> function can automate the entire process that we outlined above, but it is less customizable in exchange for its ease of use. This is how we could use it to find the s-parameters for the 2x2 mmi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gplugins.gmeep</span> <span class="kn">import</span> <span class="n">write_sparameters_meep</span>

<span class="n">pwd</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">''</span><span class="p">))</span>
<span class="n">gds_file</span> <span class="o">=</span> <span class="n">pwd</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">"files/mmi2x2.gds"</span>
<span class="n">mmi_comp</span> <span class="o">=</span> <span class="n">import_gds</span><span class="p">(</span><span class="n">gds_file</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="mi">40</span>

<span class="n">sim_is_3D</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">port_xpos</span> <span class="o">=</span> <span class="mf">17.75</span>
<span class="n">port_ypos</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.75</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">port_ysize</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">mmi_comp</span><span class="o">.</span><span class="n">add_port</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"o1"</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">port_xpos</span><span class="p">,</span> <span class="o">-</span><span class="n">port_ypos</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">port_ysize</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">cross_section</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">port_ysize</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">'WG'</span><span class="p">))</span>
<span class="n">mmi_comp</span><span class="o">.</span><span class="n">add_port</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"o2"</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">port_xpos</span><span class="p">,</span> <span class="n">port_ypos</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">port_ysize</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">cross_section</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">port_ysize</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">'WG'</span><span class="p">))</span>
<span class="n">mmi_comp</span><span class="o">.</span><span class="n">add_port</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"o3"</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="n">port_xpos</span><span class="p">,</span> <span class="o">-</span><span class="n">port_ypos</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">port_ysize</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">cross_section</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">port_ysize</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">'WG'</span><span class="p">))</span>
<span class="n">mmi_comp</span><span class="o">.</span><span class="n">add_port</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"o4"</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="n">port_xpos</span><span class="p">,</span> <span class="n">port_ypos</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">port_ysize</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">cross_section</span><span class="o">=</span><span class="n">gf</span><span class="o">.</span><span class="n">cross_section</span><span class="o">.</span><span class="n">cross_section</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">port_ysize</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">'WG'</span><span class="p">))</span>

<span class="n">sparams</span> <span class="o">=</span> <span class="n">write_sparameters_meep</span><span class="p">(</span>
        <span class="n">component</span><span class="o">=</span><span class="n">mmi_comp</span><span class="p">,</span>
        <span class="n">resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
        <span class="n">extend_ports_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">port_margin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">port_source_offset</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
        <span class="n">port_monitor_offset</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
        <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">xmargin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">ymargin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">zmargin</span><span class="o">=</span><span class="mi">2</span> <span class="k">if</span> <span class="n">sim_is_3D</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">is_3d</span><span class="o">=</span><span class="n">sim_is_3D</span><span class="p">,</span>
        <span class="n">tpml</span><span class="o">=</span><span class="n">dpml</span><span class="p">,</span>
        <span class="n">clad_material</span><span class="o">=</span><span class="s2">"SiO2"</span><span class="p">,</span>
        <span class="n">wavelength_start</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
        <span class="n">wavelength_stop</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span>
        <span class="n">wavelength_points</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://www.mathworks.com/discovery/s-parameter.html">MathWorks: What are S-Parameters</a></p>
<p><a class="reference external" href="https://docs.lucedaphotonics.com/guides/caphe_models_frequency/scatter_matrix">Luceda: Scatter matrix</a></p>
<p><a class="reference external" href="https://www.microwaves101.com/encyclopedias/s-parameters">Microwaves101: S-Parameters</a></p>
<p><a class="reference external" href="https://www.youtube.com/watch?v=-Pi0UbErHTY">Youtube: Understanding S-Parameters</a></p>
</section>
</section>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./pages"
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
</article>
<footer class="prev-next-footer">
<div class="prev-next-area">
<a class="left-prev" href="compact_models.html" title="previous page">
<i class="fa-solid fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Compact models</p>
</div>
</a>
<a class="right-next" href="drc.html" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">Design rule checks</p>
</div>
<i class="fa-solid fa-angle-right"></i>
</a>
</div>
</footer>
</div>
<div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">
<div class="sidebar-secondary-item">
<div class="page-toc tocsection onthispage">
<i class="fa-solid fa-list"></i> Contents
  </div>
<nav class="bd-toc-nav page-toc">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-scattering-parameters">What are scattering parameters?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-are-s-parameters-useful">Why are S-Parameters useful?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation">How to find S-Parameters for an arbitrary device using a meep simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-import-geometry">Step 1 - Import Geometry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-run-simulation-for-a-single-source">Step 2: Run simulation for a single source</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-run-the-same-simulation-for-each-port">Step 3: Run the same simulation for each port</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-parameters-across-different-frequencies">S-Parameters across different Frequencies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-gplugins-gmeep-write-sparameters-meep">Using <code class="docutils literal notranslate"><span class="pre">gplugins.gmeep.write_sparameters_meep</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</nav></div>
</div></div>
</div>
<footer class="bd-footer-content">
<div class="bd-footer-content__inner container">
<div class="footer-item">
<p class="component-author">
By CamachoLab and Google
</p>
</div>
<div class="footer-item">
<p class="copyright">
    
      © Copyright 2023.
      <br/>
</p>
</div>
<div class="footer-item">
</div>
<div class="footer-item">
</div>
</div>
</footer>
</main>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>
<footer class="bd-footer">
</footer>
<script src="../_static/scripts/chattutor.config.js"></script><script src="../_static/scripts/chattutor.min.js" type="module"></script></body>
</html>