
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Scattering Parameters (S-Parameters) &#8212; CamachoLab Photonics Bootcamp</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://byucamacholab.github.io/Photonics-Bootcamp/pages/scattering_parameters.html" />
    <link rel="shortcut icon" href="../_static/favicon-laser.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Front Matter
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="credits.html">
   Credits
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Familiar with Code
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="open_source.html">
   Open Source Software
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Passive Device Design and Simulation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="what_is_a_photonic_device.html">
   What is a Photonic Device?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="directional_couplers.html">
   Directional Couplers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mmis.html">
   Multimode Interferometers (MMIs)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/BYUCamachoLab/sky130ph">
   Repository
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/BYUCamachoLab/sky130ph/docs">
   PDK Documentation
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/pages/scattering_parameters.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#todo-what-are-scattering-parameters">
   TODO: What are Scattering Parameters?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#todo-why-are-s-parameters-useful">
   TODO: Why are S-Parameters useful?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#todo-demonstration-of-using-simphony-to-simulate-a-circuit-quickly-using-s-parameters">
   TODO: Demonstration of using simphony to simulate a circuit quickly using s-parameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation">
   How to find S-Parameters for an arbitrary device using a meep simulation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-1-import-geometry">
     Step 1 - Import Geometry
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-2-run-simulation-for-a-single-source">
     Step 2: Run simulation for a single source
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-3-run-the-same-simulation-for-each-of-the-other-ports">
     Step 3: Run the same simulation for each of the other ports
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Scattering Parameters (S-Parameters)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#todo-what-are-scattering-parameters">
   TODO: What are Scattering Parameters?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#todo-why-are-s-parameters-useful">
   TODO: Why are S-Parameters useful?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#todo-demonstration-of-using-simphony-to-simulate-a-circuit-quickly-using-s-parameters">
   TODO: Demonstration of using simphony to simulate a circuit quickly using s-parameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation">
   How to find S-Parameters for an arbitrary device using a meep simulation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-1-import-geometry">
     Step 1 - Import Geometry
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-2-run-simulation-for-a-single-source">
     Step 2: Run simulation for a single source
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#step-3-run-the-same-simulation-for-each-of-the-other-ports">
     Step 3: Run the same simulation for each of the other ports
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="scattering-parameters-s-parameters">
<h1>Scattering Parameters (S-Parameters)<a class="headerlink" href="#scattering-parameters-s-parameters" title="Permalink to this headline">#</a></h1>
<section id="todo-what-are-scattering-parameters">
<h2>TODO: What are Scattering Parameters?<a class="headerlink" href="#todo-what-are-scattering-parameters" title="Permalink to this headline">#</a></h2>
</section>
<section id="todo-why-are-s-parameters-useful">
<h2>TODO: Why are S-Parameters useful?<a class="headerlink" href="#todo-why-are-s-parameters-useful" title="Permalink to this headline">#</a></h2>
</section>
<section id="todo-demonstration-of-using-simphony-to-simulate-a-circuit-quickly-using-s-parameters">
<h2>TODO: Demonstration of using simphony to simulate a circuit quickly using s-parameters<a class="headerlink" href="#todo-demonstration-of-using-simphony-to-simulate-a-circuit-quickly-using-s-parameters" title="Permalink to this headline">#</a></h2>
</section>
<section id="how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation">
<h2>How to find S-Parameters for an arbitrary device using a meep simulation<a class="headerlink" href="#how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation" title="Permalink to this headline">#</a></h2>
<p>In this section we’ll demonstrate how to find the s-params for any device using a meep simulation. We’ll show both 2D and 3D simulations, but keep in mind that 2D s-params are not very accurate. We’ll run through the steps using gdsfactory’s default 2x2 mmi, and explain on the way how the principles can be applied to any component.</p>
<section id="step-1-import-geometry">
<h3>Step 1 - Import Geometry<a class="headerlink" href="#step-1-import-geometry" title="Permalink to this headline">#</a></h3>
<p>For our simulation, it makes life easy if we add all of our sources and detectors into our gds before we import it into meep. For this tutorial I have already done this. For your simulations, you can modify your gds file directly in Klayout if you like a GUI, or you can use gdsfactory itself. If you like, you can also use meep to do the same thing, but I won’t be showing how to do that here.</p>
<p>Here is a picture of the gds we will be using.</p>
<p><img alt="Image of splitter file" src="https://raw.githubusercontent.com/BYUCamachoLab/Photonics-Bootcamp/main/book/images/Notebook_Images/mmi2x2_gds_with_ports.png" /></p>
<p>I’ve added a box around the entire component (in purple) which will become the simulation region, and 8 lines, 2 on each end that will become the sources and detectors. I also added straight waveguides on the ports of the gdsfactory mmi so that my ports could be exactly where the light would enter and exit the component in an actual circuit. My sources are then slightly outside the mmi, in the waveguides.</p>
<p>So, now that we have a gds, lets import it into meep!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">meep</span> <span class="k">as</span> <span class="nn">mp</span> 
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
</div>
</div>
<p>Next we’ll define a whole bunch of variables so our code is more readable down the line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># the resolution of the simulation in pixels/um</span>
<span class="n">three_d</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Turn this to false for a 2D simulation</span>

<span class="n">gds_file</span> <span class="o">=</span> <span class="s2">&quot;mmi2x2.gds&quot;</span> <span class="c1"># The name of our gds file</span>

<span class="c1"># Here we define the layer numbers for each part of our gds</span>
<span class="n">geometry_L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">cell_L</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">port1_L</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">port2_L</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">port3_L</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">port4_L</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">source1_L</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">source2_L</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">source3_L</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">source4_L</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># The Parameters for the frequencies we&#39;ll be using</span>
<span class="n">lcen</span> <span class="o">=</span> <span class="mf">1.55</span> <span class="c1"># Center wavelength</span>
<span class="n">fcen</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">lcen</span> <span class="c1"># Center frequency</span>
<span class="n">df</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">fcen</span> <span class="c1"># Frequency Diameter</span>

<span class="c1"># The thickness of each material in our simulation (only used in 3D simulations)</span>
<span class="n">t_oxide</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">t_Si</span> <span class="o">=</span> <span class="mf">0.22</span>
<span class="n">t_air</span> <span class="o">=</span> <span class="mf">0.78</span>

<span class="n">dpml</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Diameter of perfectly matched layers</span>
<span class="n">cell_thickness</span> <span class="o">=</span> <span class="n">dpml</span> <span class="o">+</span> <span class="n">t_oxide</span> <span class="o">+</span> <span class="n">t_Si</span> <span class="o">+</span> <span class="n">t_air</span> <span class="o">+</span> <span class="n">dpml</span> <span class="c1"># Cell thickness</span>

<span class="c1"># The materials we will have in our simulation, silicon and SiO2</span>
<span class="n">oxide</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">2.25</span><span class="p">)</span>
<span class="n">silicon</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Sets the min and max values for the cell and the silicon. Our simulation will be centered at y=0</span>
<span class="n">cell_zmax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">cell_thickness</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="mi">0</span>
<span class="n">cell_zmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">cell_thickness</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="mi">0</span>
<span class="n">si_zmax</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">t_Si</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="mi">10</span> <span class="c1"># In a 2D simulation, the geometry still has to have a thickness or it won&#39;t show up</span>
<span class="n">si_zmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">t_Si</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="o">-</span><span class="mi">10</span>

<span class="c1"># Create a 2D array to hold the S-Parameters for the device</span>
<span class="n">numPorts</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># The number of ports, also the size of our array</span>
<span class="n">s_params</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPorts</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPorts</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we’ll import our geometries from the gds file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">###################################################</span>
<span class="c1"># Now we actually import the geometry</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_prisms</span><span class="p">(</span><span class="n">silicon</span><span class="p">,</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">geometry_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">si_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">si_zmin</span><span class="p">)</span> <span class="c1"># Gets the geometry of the mmi</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">cell_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span> <span class="c1"># cell geometry. We use mp.GDSII_vol() instead of mp.GDSII_prims() because they return different types</span>
<span class="n">port1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">port1_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span> <span class="c1"># Port geometry</span>
<span class="n">port2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">port2_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>
<span class="n">port3</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">port3_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>
<span class="n">port4</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">port4_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>
<span class="n">source1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">source1_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span> <span class="c1"># Source Geometry</span>
<span class="n">source2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">source2_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>
<span class="n">source3</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">source3_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>
<span class="n">source4</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">source4_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>

<span class="k">if</span> <span class="n">three_d</span><span class="p">:</span> <span class="c1"># Sets up the oxide cladding for a three d simulation (Not used in a 2D simulation)</span>
    <span class="n">oxide_center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">z</span><span class="o">=-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">t_oxide</span><span class="p">)</span>
    <span class="n">oxide_size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cell</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">t_oxide</span><span class="p">)</span>
    <span class="n">oxide_layer</span> <span class="o">=</span> <span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="n">material</span><span class="o">=</span><span class="n">oxide</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">oxide_center</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">oxide_size</span><span class="p">)]</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="o">+</span> <span class="n">oxide_layer</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Vector3&lt;35.5, 10.0, 0.0&gt;
Vector3&lt;0.0, 0.0, 0.0&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2-run-simulation-for-a-single-source">
<h3>Step 2: Run simulation for a single source<a class="headerlink" href="#step-2-run-simulation-for-a-single-source" title="Permalink to this headline">#</a></h3>
<p>In order to find all the S-Parameters for a device, we have to run a simulation for each port. Each time we switch where the source is, and then get the S-parameters from that port. So, for this component, I’ll run 4 simulations, each time injecting the light into a different port. Then I’ll calculate the S-parameters between the port that has the light, and every other port.</p>
<p>Because I added geometry for the sources in the gds, we just have to input that geometry into the source instead of constructing it in meep.
TODO: Explain briefly why we use the eig_parity we do, and what the eig_band and eig_match_freq</p>
<p>Once we define the source in meep, we can create a simulation object by simply passing all of the necessary parts into the contructor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the first source for the simulation. I&#39;ll start with port1 (the lower left)</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">source1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">source1</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

    <span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Create Simulation</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="c1"># The resolution, defined further up</span>
    <span class="n">cell_size</span><span class="o">=</span><span class="n">cell</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># The cell size, taken from the gds</span>
    <span class="n">boundary_layers</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">dpml</span><span class="p">)],</span> <span class="c1"># the perfectly matched layers, with a diameter as defined above</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="n">sources</span><span class="p">,</span> <span class="c1"># The source(s) we just defined</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="c1"># The geometry, from above</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>After creating the simulation object, we can add mode monitors at each of the ports. These will read how much light comes in/out of each port.</p>
<p>Now that our simulation is completely set up for the first source, I can plot it to make sure everything looks right before running the simulation. We do that using the plot2D() method of the simulation object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adds mode monitors at each of the ports to track the energy that goes in or out</span>
<span class="n">modePort1</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port1</span><span class="p">))</span>
<span class="n">modePort2</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port2</span><span class="p">))</span>
<span class="n">modePort3</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port3</span><span class="p">))</span>
<span class="n">modePort4</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port4</span><span class="p">))</span>

<span class="c1"># Plot the simulation</span>
<span class="n">sim</span><span class="o">.</span><span class="n">plot2D</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     prism, center = (-7.75,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,-1.125,-10)
          (-12.75,-0.875,-10)
          (-12.75,-0.375,-10)
          (-2.75,-0.125,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-7.75,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,0.125,-10)
          (-12.75,0.375,-10)
          (-12.75,0.875,-10)
          (-2.75,1.125,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (7.75,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (2.75,0.125,-10)
          (2.75,1.125,-10)
          (12.75,0.875,-10)
          (12.75,0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (7.75,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (2.75,-1.125,-10)
          (2.75,-0.125,-10)
          (12.75,-0.375,-10)
          (12.75,-0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (0,0,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,-1.25,-10)
          (-2.75,1.25,-10)
          (2.75,1.25,-10)
          (2.75,-1.25,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-15.25,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-12.75,-0.375,-10)
          (-12.75,-0.875,-10)
          (-17.75,-0.875,-10)
          (-17.75,-0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-15.25,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-12.75,0.875,-10)
          (-12.75,0.375,-10)
          (-17.75,0.375,-10)
          (-17.75,0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (15.25,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (12.75,0.375,-10)
          (12.75,0.875,-10)
          (17.75,0.875,-10)
          (17.75,0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (15.25,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (12.75,-0.875,-10)
          (12.75,-0.375,-10)
          (17.75,-0.375,-10)
          (17.75,-0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/jkart/anaconda3/envs/mp/lib/python3.11/site-packages/numpy/core/getlimits.py:518: UserWarning: The value of the smallest subnormal for &lt;class &#39;numpy.float64&#39;&gt; type is zero.
  setattr(self, word, getattr(machar, word).flat[0])
/home/jkart/anaconda3/envs/mp/lib/python3.11/site-packages/numpy/core/getlimits.py:89: UserWarning: The value of the smallest subnormal for &lt;class &#39;numpy.float64&#39;&gt; type is zero.
  return self._float_to_str(self.smallest_subnormal)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;X&#39;, ylabel=&#39;Y&#39;&gt;
</pre></div>
</div>
<img alt="../_images/scattering_parameters_14_3.png" src="../_images/scattering_parameters_14_3.png" />
</div>
</div>
<p>As we see from the output of sim.plot2D(), our simulation is set up correctly. The red is our source, the blue are our 4 mode monitors, an the black is the geometry. We are ready to run the simulation! Actually running the simulation is the most computationally intense part of this, so it may take some time. The until_after_sources parameter for sim.run() means the run the simulation until 100 meep time units after the sources have turned off. This makes sure the all of the light has time to propagate through the mmi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Runs the simulation</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until_after_sources</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-----------
Initializing structure...
time for choose_chunkdivision = 0.00529408 s
Working in 2D dimensions.
Computational cell is 35.5 x 10 x 0 with resolution 50
     prism, center = (-7.75,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,-1.125,-10)
          (-12.75,-0.875,-10)
          (-12.75,-0.375,-10)
          (-2.75,-0.125,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-7.75,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,0.125,-10)
          (-12.75,0.375,-10)
          (-12.75,0.875,-10)
          (-2.75,1.125,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (7.75,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (2.75,0.125,-10)
          (2.75,1.125,-10)
          (12.75,0.875,-10)
          (12.75,0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (7.75,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (2.75,-1.125,-10)
          (2.75,-0.125,-10)
          (12.75,-0.375,-10)
          (12.75,-0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (0,0,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,-1.25,-10)
          (-2.75,1.25,-10)
          (2.75,1.25,-10)
          (2.75,-1.25,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-15.25,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-12.75,-0.375,-10)
          (-12.75,-0.875,-10)
          (-17.75,-0.875,-10)
          (-17.75,-0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-15.25,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-12.75,0.875,-10)
          (-12.75,0.375,-10)
          (-17.75,0.375,-10)
          (-17.75,0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (15.25,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (12.75,0.375,-10)
          (12.75,0.875,-10)
          (17.75,0.875,-10)
          (17.75,0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (15.25,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (12.75,-0.875,-10)
          (12.75,-0.375,-10)
          (17.75,-0.375,-10)
          (17.75,-0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
time for set_epsilon = 7.99664 s
-----------
MPB solved for frequency_1(2.2349,0,0) = 0.68454 after 25 iters
MPB solved for frequency_1(2.09412,0,0) = 0.645204 after 16 iters
MPB solved for frequency_1(2.09396,0,0) = 0.645161 after 3 iters
MPB solved for frequency_1(2.09396,0,0) = 0.645161 after 1 iters
Meep progress: 5.36/177.5 = 3.0% done in 4.0s, 128.6s to go
on time step 536 (time=5.36), 0.00747186 s/step
Meep progress: 11.02/177.5 = 6.2% done in 8.0s, 121.0s to go
on time step 1102 (time=11.02), 0.00706902 s/step
Meep progress: 16.16/177.5 = 9.1% done in 12.0s, 119.9s to go
on time step 1617 (time=16.17), 0.00778053 s/step
Meep progress: 21.66/177.5 = 12.2% done in 16.0s, 115.2s to go
on time step 2167 (time=21.67), 0.00727634 s/step
Meep progress: 27.44/177.5 = 15.5% done in 20.0s, 109.4s to go
on time step 2746 (time=27.46), 0.00692036 s/step
Meep progress: 33.17/177.5 = 18.7% done in 24.0s, 104.5s to go
on time step 3319 (time=33.19), 0.00698557 s/step
Meep progress: 38.6/177.5 = 21.7% done in 28.0s, 100.8s to go
on time step 3862 (time=38.62), 0.00738276 s/step
Meep progress: 44.230000000000004/177.5 = 24.9% done in 32.0s, 96.5s to go
on time step 4426 (time=44.26), 0.00710481 s/step
Meep progress: 49.42/177.5 = 27.8% done in 36.0s, 93.4s to go
on time step 4946 (time=49.46), 0.00769938 s/step
Meep progress: 55.160000000000004/177.5 = 31.1% done in 40.0s, 88.8s to go
on time step 5520 (time=55.2), 0.00697911 s/step
Meep progress: 60.58/177.5 = 34.1% done in 44.0s, 85.0s to go
on time step 6063 (time=60.63), 0.00737774 s/step
Meep progress: 66.31/177.5 = 37.4% done in 48.0s, 80.5s to go
on time step 6636 (time=66.36), 0.00699293 s/step
Meep progress: 71.52/177.5 = 40.3% done in 52.0s, 77.1s to go
on time step 7158 (time=71.58), 0.00767205 s/step
Meep progress: 76.28/177.5 = 43.0% done in 56.0s, 74.4s to go
on time step 7634 (time=76.34), 0.00841526 s/step
Meep progress: 82.0/177.5 = 46.2% done in 60.0s, 69.9s to go
on time step 8206 (time=82.06), 0.00699341 s/step
Meep progress: 87.69/177.5 = 49.4% done in 64.1s, 65.6s to go
on time step 8773 (time=87.73), 0.00705685 s/step
Meep progress: 93.31/177.5 = 52.6% done in 68.1s, 61.4s to go
on time step 9335 (time=93.35), 0.00711779 s/step
Meep progress: 98.93/177.5 = 55.7% done in 72.1s, 57.2s to go
on time step 9897 (time=98.97), 0.00711772 s/step
Meep progress: 104.35000000000001/177.5 = 58.8% done in 76.1s, 53.3s to go
on time step 10438 (time=104.38), 0.00739647 s/step
Meep progress: 109.89/177.5 = 61.9% done in 80.1s, 49.3s to go
on time step 10993 (time=109.93), 0.00721794 s/step
Meep progress: 115.24000000000001/177.5 = 64.9% done in 84.1s, 45.4s to go
on time step 11528 (time=115.28), 0.0074825 s/step
Meep progress: 120.89/177.5 = 68.1% done in 88.1s, 41.2s to go
on time step 12093 (time=120.93), 0.00708574 s/step
Meep progress: 125.97/177.5 = 71.0% done in 92.1s, 37.7s to go
on time step 12599 (time=125.99), 0.00790545 s/step
Meep progress: 131.03/177.5 = 73.8% done in 96.1s, 34.1s to go
on time step 13106 (time=131.06), 0.00790283 s/step
Meep progress: 136.09/177.5 = 76.7% done in 100.1s, 30.5s to go
on time step 13612 (time=136.12), 0.00790922 s/step
Meep progress: 141.0/177.5 = 79.4% done in 104.1s, 26.9s to go
on time step 14104 (time=141.04), 0.00814043 s/step
Meep progress: 146.1/177.5 = 82.3% done in 108.1s, 23.2s to go
on time step 14614 (time=146.14), 0.0078519 s/step
Meep progress: 151.62/177.5 = 85.4% done in 112.1s, 19.1s to go
on time step 15165 (time=151.65), 0.00726033 s/step
Meep progress: 157.14000000000001/177.5 = 88.5% done in 116.1s, 15.0s to go
on time step 15718 (time=157.18), 0.00724463 s/step
Meep progress: 162.81/177.5 = 91.7% done in 120.1s, 10.8s to go
on time step 16285 (time=162.85), 0.00706163 s/step
Meep progress: 168.33/177.5 = 94.8% done in 124.1s, 6.8s to go
on time step 16837 (time=168.37), 0.00725161 s/step
Meep progress: 173.92000000000002/177.5 = 98.0% done in 128.1s, 2.6s to go
on time step 17396 (time=173.96), 0.00715696 s/step
run 0 finished at t = 177.5 (17750 timesteps)
</pre></div>
</div>
</div>
</div>
<p>Now that our simulation has been run, we’ll quickly compute the s-parameters, store them in our array, and print them out. The function sim.get_eigenmode_coefficients() returns an array that holds the parameters for every mode, every frequency, and in the forward and backward direction. Depending on your application, the specific frequency and mode may matter, but in general we want the fundamental TE mode and at the center frequency. However, we do care about the direction. In our simulation, light will go in port 1 going forward (towards positive X) and exit ports 3 and 4 in the same direction, but any light exiting port 2 will be going backwards (towards negative X). So, we change the alpha to be (0,0,1) for port 2. The 1 in the third spot indicates the backward propagating light.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span> <span class="c1"># This array holds the values for forwards and backward propagation for each soure. </span>
<span class="c1"># Finds the S parameters</span>
<span class="n">port1_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modePort1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">port2_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modePort2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">port3_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modePort3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">port4_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modePort4</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]]</span>

<span class="c1"># Store the S parameters in s_params</span>
<span class="n">s_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">port1_coeff</span><span class="p">,</span> <span class="n">port2_coeff</span><span class="p">,</span> <span class="n">port3_coeff</span><span class="p">,</span> <span class="n">port4_coeff</span><span class="p">]</span>


<span class="c1"># Prints out the S parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;S params: Port1(Lower Left, S11): </span><span class="si">{:.6f}</span><span class="s2">  Port2(Upper Left, S12): </span><span class="si">{:.6f}</span><span class="s2">  Port3(Upper Right, S13): </span><span class="si">{:.6f}</span><span class="s2">  Port4(Lower Right, S14): </span><span class="si">{:.6f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port1_coeff</span><span class="p">,</span> <span class="n">port2_coeff</span><span class="p">,</span> <span class="n">port3_coeff</span><span class="p">,</span> <span class="n">port4_coeff</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)

-----------------------------------------------------------------

S params: Port1(Lower Left, S11): 2.073837+7.487299j  Port2(Upper Left, S12): 0.102670+0.354179j  Port3(Upper Right, S13): 1.861903+0.719638j  Port4(Lower Right, S14): -1.243318-5.965357j

-----------------------------------------------------------------
</pre></div>
</div>
</div>
</div>
<p>Just for fun, we’ll also compute and print the transmittance through each port and the total insertion loss. We won’t do this with the other ports, but it’s a good exercise here.</p>
<p>We find that this component is actually terrible and would never be used in an actual photonic design. Almost a third of the light is lost, and the light that isn’t lost is not split in any specific ratio. Fortunately, it was never meant to be used, and jsut exists as an example of the basic shape of an mmi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculates the transmittance based off of the S parameters</span>
<span class="n">port2_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port2_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port1_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">port3_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port3_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port1_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">port4_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port4_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port1_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="c1"># Calculates the Insertion loss as a percent and in dB</span>
<span class="n">insertionLoss</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">port2_trans</span> <span class="o">+</span> <span class="n">port3_trans</span> <span class="o">+</span> <span class="n">port4_trans</span><span class="p">)</span>
<span class="n">insertionLoss_dB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">insertionLoss</span><span class="p">)</span> 

<span class="c1"># Prints the Transmittance</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trans: Port2: </span><span class="si">{:.6f}</span><span class="s2">%, Port3: </span><span class="si">{:.6f}</span><span class="s2">%, Port4: </span><span class="si">{:.6f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port2_trans</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">port3_trans</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">port4_trans</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Insertion Loss: </span><span class="si">{:.6f}</span><span class="s2">% -&gt; </span><span class="si">{:.6f}</span><span class="s2">db&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">insertionLoss</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">insertionLoss_dB</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-----------------------------------------------------------------

trans: Port2: 0.225287%, Port3: 6.601281%, Port4: 61.515984%
Insertion Loss: 31.657449% -&gt; -4.995241db

-----------------------------------------------------------------
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-3-run-the-same-simulation-for-each-of-the-other-ports">
<h3>Step 3: Run the same simulation for each of the other ports<a class="headerlink" href="#step-3-run-the-same-simulation-for-each-of-the-other-ports" title="Permalink to this headline">#</a></h3>
<p>Now, all that’s left to do is to run the simulation for each source. Here, I’ll use a for loop to run the other three simulations. We could have done this for all four, but hopefully this makes the code make more sense.</p>
<p>For the sources going into port 3 and 4, we have to specify that the light will be propagating backwards. Below, I’ve done this by setting the direction to mp.NO_DIRECTION and using the eig_kpoint parameter to specify the direction. You can use this same method to launch sources in any direction.</p>
<p>It should be noted, that since the 2x2 mmi we are using is symmetrical across both the x and y axies, the S-parameters should be the same for all of the other ports. But for the sake of demonstration, we’ll simulate all of them. Then at then end we can check to see the the S-parameters are actually the same.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the rest of the sources for the simulation.</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">source2</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">source2</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

    <span class="p">),</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">source3</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">source3</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">eig_kpoint</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_DIRECTION</span>

    <span class="p">),</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">source4</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">source4</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">eig_kpoint</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_DIRECTION</span>

    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPorts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">sources</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">sim</span><span class="o">.</span><span class="n">reset_meep</span><span class="p">()</span> <span class="c1"># resets everything</span>

    <span class="c1"># Create Simulation</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="c1"># The resolution, defined further up</span>
    <span class="n">cell_size</span><span class="o">=</span><span class="n">cell</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># The cell size, taken from the gds</span>
    <span class="n">boundary_layers</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">dpml</span><span class="p">)],</span> <span class="c1"># the perfectly matched layers, with a diameter as defined above</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span> <span class="c1"># The source(s) we just defined</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="c1"># The geometry, from above</span>
    <span class="p">)</span>
    
    <span class="c1"># Adds mode monitors at each of the ports to track the energy that goes in or out</span>
    <span class="n">modePort1</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port1</span><span class="p">))</span>
    <span class="n">modePort2</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port2</span><span class="p">))</span>
    <span class="n">modePort3</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port3</span><span class="p">))</span>
    <span class="n">modePort4</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port4</span><span class="p">))</span>

    <span class="c1"># Runs the simulation</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until_after_sources</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1">#############################################################</span>
    <span class="c1"># Finds the S parameters</span>
    <span class="n">port1_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modePort1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">port2_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modePort2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">port3_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modePort3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">port4_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modePort4</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]]</span>

    <span class="c1"># Store the S parameters in s_params</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">i</span> 
    <span class="n">s_params</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">port1_coeff</span><span class="p">,</span> <span class="n">port2_coeff</span><span class="p">,</span> <span class="n">port3_coeff</span><span class="p">,</span> <span class="n">port4_coeff</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-----------
Initializing structure...
time for choose_chunkdivision = 0.00290012 s
Working in 2D dimensions.
Computational cell is 35.5 x 10 x 0 with resolution 50
     prism, center = (-7.75,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,-1.125,-10)
          (-12.75,-0.875,-10)
          (-12.75,-0.375,-10)
          (-2.75,-0.125,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-7.75,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,0.125,-10)
          (-12.75,0.375,-10)
          (-12.75,0.875,-10)
          (-2.75,1.125,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (7.75,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (2.75,0.125,-10)
          (2.75,1.125,-10)
          (12.75,0.875,-10)
          (12.75,0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (7.75,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (2.75,-1.125,-10)
          (2.75,-0.125,-10)
          (12.75,-0.375,-10)
          (12.75,-0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (0,0,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,-1.25,-10)
          (-2.75,1.25,-10)
          (2.75,1.25,-10)
          (2.75,-1.25,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-15.25,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-12.75,-0.375,-10)
          (-12.75,-0.875,-10)
          (-17.75,-0.875,-10)
          (-17.75,-0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-15.25,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-12.75,0.875,-10)
          (-12.75,0.375,-10)
          (-17.75,0.375,-10)
          (-17.75,0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (15.25,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (12.75,0.375,-10)
          (12.75,0.875,-10)
          (17.75,0.875,-10)
          (17.75,0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (15.25,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (12.75,-0.875,-10)
          (12.75,-0.375,-10)
          (17.75,-0.375,-10)
          (17.75,-0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
time for set_epsilon = 6.98248 s
-----------
MPB solved for frequency_1(2.2349,0,0) = 0.68454 after 25 iters
MPB solved for frequency_1(2.09412,0,0) = 0.645204 after 16 iters
MPB solved for frequency_1(2.09396,0,0) = 0.645161 after 3 iters
MPB solved for frequency_1(2.09396,0,0) = 0.645161 after 1 iters
Meep progress: 5.4/177.5 = 3.0% done in 4.0s, 127.6s to go
on time step 540 (time=5.4), 0.0074173 s/step
Meep progress: 10.92/177.5 = 6.2% done in 8.0s, 122.1s to go
on time step 1092 (time=10.92), 0.00724845 s/step
Meep progress: 15.97/177.5 = 9.0% done in 12.0s, 121.5s to go
on time step 1597 (time=15.97), 0.0079231 s/step
Meep progress: 21.06/177.5 = 11.9% done in 16.0s, 118.9s to go
on time step 2106 (time=21.06), 0.00786279 s/step
Meep progress: 25.89/177.5 = 14.6% done in 20.0s, 117.2s to go
on time step 2589 (time=25.89), 0.00828704 s/step
Meep progress: 31.21/177.5 = 17.6% done in 24.0s, 112.6s to go
on time step 3121 (time=31.21), 0.00753029 s/step
Meep progress: 36.88/177.5 = 20.8% done in 28.0s, 106.8s to go
on time step 3689 (time=36.89), 0.00705393 s/step
Meep progress: 42.52/177.5 = 24.0% done in 32.0s, 101.7s to go
on time step 4253 (time=42.53), 0.00709569 s/step
Meep progress: 48.2/177.5 = 27.2% done in 36.0s, 96.6s to go
on time step 4822 (time=48.22), 0.00704004 s/step
Meep progress: 53.86/177.5 = 30.3% done in 40.0s, 91.9s to go
on time step 5389 (time=53.89), 0.00706493 s/step
Meep progress: 59.63/177.5 = 33.6% done in 44.0s, 87.0s to go
on time step 5965 (time=59.65), 0.00695122 s/step
Meep progress: 64.56/177.5 = 36.4% done in 48.0s, 84.0s to go
on time step 6458 (time=64.58), 0.00811795 s/step
Meep progress: 69.79/177.5 = 39.3% done in 52.0s, 80.3s to go
on time step 6982 (time=69.82), 0.0076401 s/step
Meep progress: 75.51/177.5 = 42.5% done in 56.0s, 75.7s to go
on time step 7555 (time=75.55), 0.0069892 s/step
Meep progress: 81.17/177.5 = 45.7% done in 60.0s, 71.3s to go
on time step 8120 (time=81.2), 0.00708016 s/step
Meep progress: 86.8/177.5 = 48.9% done in 64.0s, 66.9s to go
on time step 8684 (time=86.84), 0.00710193 s/step
Meep progress: 92.56/177.5 = 52.1% done in 68.0s, 62.4s to go
on time step 9261 (time=92.61), 0.00693921 s/step
Meep progress: 97.61/177.5 = 55.0% done in 72.0s, 59.0s to go
on time step 9764 (time=97.64), 0.00796255 s/step
Meep progress: 102.06/177.5 = 57.5% done in 76.1s, 56.2s to go
on time step 10209 (time=102.09), 0.00899464 s/step
Meep progress: 107.12/177.5 = 60.3% done in 80.1s, 52.6s to go
on time step 10716 (time=107.16), 0.00789691 s/step
Meep progress: 112.27/177.5 = 63.3% done in 84.1s, 48.8s to go
on time step 11230 (time=112.3), 0.00778421 s/step
Meep progress: 117.71000000000001/177.5 = 66.3% done in 88.1s, 44.7s to go
on time step 11774 (time=117.74), 0.00735968 s/step
Meep progress: 123.27/177.5 = 69.4% done in 92.1s, 40.5s to go
on time step 12330 (time=123.3), 0.00719767 s/step
Meep progress: 128.92000000000002/177.5 = 72.6% done in 96.1s, 36.2s to go
on time step 12894 (time=128.94), 0.00709637 s/step
Meep progress: 134.64000000000001/177.5 = 75.9% done in 100.1s, 31.9s to go
on time step 13467 (time=134.67), 0.00698867 s/step
Meep progress: 140.11/177.5 = 78.9% done in 104.1s, 27.8s to go
on time step 14014 (time=140.14), 0.00731977 s/step
Meep progress: 145.05/177.5 = 81.7% done in 108.1s, 24.2s to go
on time step 14507 (time=145.07), 0.00811854 s/step
Meep progress: 149.44/177.5 = 84.2% done in 112.1s, 21.0s to go
on time step 14946 (time=149.46), 0.00911289 s/step
Meep progress: 154.94/177.5 = 87.3% done in 116.1s, 16.9s to go
on time step 15496 (time=154.96), 0.00727285 s/step
Meep progress: 160.62/177.5 = 90.5% done in 120.1s, 12.6s to go
on time step 16064 (time=160.64), 0.0070514 s/step
Meep progress: 166.37/177.5 = 93.7% done in 124.1s, 8.3s to go
on time step 16639 (time=166.39), 0.00696617 s/step
Meep progress: 172.19/177.5 = 97.0% done in 128.1s, 4.0s to go
on time step 17221 (time=172.21), 0.00688328 s/step
run 0 finished at t = 177.5 (17750 timesteps)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
-----------
Initializing structure...
time for choose_chunkdivision = 0.00135112 s
Working in 2D dimensions.
Computational cell is 35.5 x 10 x 0 with resolution 50
     prism, center = (-7.75,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,-1.125,-10)
          (-12.75,-0.875,-10)
          (-12.75,-0.375,-10)
          (-2.75,-0.125,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-7.75,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,0.125,-10)
          (-12.75,0.375,-10)
          (-12.75,0.875,-10)
          (-2.75,1.125,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (7.75,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (2.75,0.125,-10)
          (2.75,1.125,-10)
          (12.75,0.875,-10)
          (12.75,0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (7.75,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (2.75,-1.125,-10)
          (2.75,-0.125,-10)
          (12.75,-0.375,-10)
          (12.75,-0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (0,0,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,-1.25,-10)
          (-2.75,1.25,-10)
          (2.75,1.25,-10)
          (2.75,-1.25,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-15.25,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-12.75,-0.375,-10)
          (-12.75,-0.875,-10)
          (-17.75,-0.875,-10)
          (-17.75,-0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-15.25,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-12.75,0.875,-10)
          (-12.75,0.375,-10)
          (-17.75,0.375,-10)
          (-17.75,0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (15.25,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (12.75,0.375,-10)
          (12.75,0.875,-10)
          (17.75,0.875,-10)
          (17.75,0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (15.25,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (12.75,-0.875,-10)
          (12.75,-0.375,-10)
          (17.75,-0.375,-10)
          (17.75,-0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
time for set_epsilon = 6.98586 s
-----------
MPB solved for frequency_1(-1,0,0) = 0.339081 after 9 iters
MPB solved for frequency_1(-2.06483,0,0) = 0.637031 after 7 iters
MPB solved for frequency_1(-2.09396,0,0) = 0.645159 after 12 iters
MPB solved for frequency_1(-2.09396,0,0) = 0.645161 after 1 iters
Meep progress: 5.62/177.5 = 3.2% done in 4.0s, 122.4s to go
on time step 562 (time=5.62), 0.00712105 s/step
Meep progress: 11.370000000000001/177.5 = 6.4% done in 8.0s, 116.9s to go
on time step 1137 (time=11.37), 0.0069589 s/step
Meep progress: 17.23/177.5 = 9.7% done in 12.0s, 111.7s to go
on time step 1723 (time=17.23), 0.00683258 s/step
Meep progress: 22.02/177.5 = 12.4% done in 16.0s, 113.1s to go
on time step 2202 (time=22.02), 0.00836242 s/step
Meep progress: 26.5/177.5 = 14.9% done in 20.0s, 114.1s to go
on time step 2650 (time=26.5), 0.00893408 s/step
Meep progress: 31.82/177.5 = 17.9% done in 24.0s, 110.0s to go
on time step 3182 (time=31.82), 0.00753351 s/step
Meep progress: 36.52/177.5 = 20.6% done in 28.0s, 108.2s to go
on time step 3652 (time=36.52), 0.00851833 s/step
Meep progress: 41.65/177.5 = 23.5% done in 32.0s, 104.5s to go
on time step 4165 (time=41.65), 0.00780316 s/step
Meep progress: 46.9/177.5 = 26.4% done in 36.1s, 100.4s to go
on time step 4690 (time=46.9), 0.00764797 s/step
Meep progress: 52.21/177.5 = 29.4% done in 40.1s, 96.1s to go
on time step 5221 (time=52.21), 0.00754252 s/step
Meep progress: 57.53/177.5 = 32.4% done in 44.1s, 91.9s to go
on time step 5753 (time=57.53), 0.00751961 s/step
Meep progress: 62.51/177.5 = 35.2% done in 48.1s, 88.4s to go
on time step 6251 (time=62.51), 0.0080329 s/step
Meep progress: 67.23/177.5 = 37.9% done in 52.1s, 85.4s to go
on time step 6723 (time=67.23), 0.00847504 s/step
Meep progress: 71.58/177.5 = 40.3% done in 56.1s, 83.0s to go
on time step 7160 (time=71.6), 0.00917431 s/step
Meep progress: 76.44/177.5 = 43.1% done in 60.1s, 79.4s to go
on time step 7646 (time=76.46), 0.00823201 s/step
Meep progress: 81.43/177.5 = 45.9% done in 64.1s, 75.6s to go
on time step 8145 (time=81.45), 0.00801882 s/step
Meep progress: 86.58/177.5 = 48.8% done in 68.1s, 71.5s to go
on time step 8660 (time=86.6), 0.00777233 s/step
Meep progress: 90.9/177.5 = 51.2% done in 72.1s, 68.7s to go
on time step 9092 (time=90.92), 0.00927541 s/step
Meep progress: 95.54/177.5 = 53.8% done in 76.1s, 65.3s to go
on time step 9557 (time=95.57), 0.00860362 s/step
Meep progress: 101.06/177.5 = 56.9% done in 80.1s, 60.6s to go
on time step 10109 (time=101.09), 0.00725774 s/step
Meep progress: 106.84/177.5 = 60.2% done in 84.1s, 55.6s to go
on time step 10687 (time=106.87), 0.00693045 s/step
Meep progress: 112.19/177.5 = 63.2% done in 88.1s, 51.3s to go
on time step 11220 (time=112.2), 0.00750962 s/step
Meep progress: 117.44/177.5 = 66.2% done in 92.1s, 47.1s to go
on time step 11746 (time=117.46), 0.0076106 s/step
Meep progress: 122.33/177.5 = 68.9% done in 96.1s, 43.3s to go
on time step 12235 (time=122.35), 0.00819305 s/step
Meep progress: 127.3/177.5 = 71.7% done in 100.1s, 39.5s to go
on time step 12733 (time=127.33), 0.00804206 s/step
Meep progress: 131.6/177.5 = 74.1% done in 104.1s, 36.3s to go
on time step 13162 (time=131.62), 0.0093286 s/step
Meep progress: 136.06/177.5 = 76.7% done in 108.1s, 32.9s to go
on time step 13609 (time=136.09), 0.00896831 s/step
Meep progress: 141.41/177.5 = 79.7% done in 112.1s, 28.6s to go
on time step 14145 (time=141.45), 0.00746985 s/step
Meep progress: 146.93/177.5 = 82.8% done in 116.1s, 24.2s to go
on time step 14697 (time=146.97), 0.00725569 s/step
Meep progress: 152.25/177.5 = 85.8% done in 120.1s, 19.9s to go
on time step 15229 (time=152.29), 0.00752398 s/step
Meep progress: 157.92000000000002/177.5 = 89.0% done in 124.1s, 15.4s to go
on time step 15797 (time=157.97), 0.00705423 s/step
Meep progress: 163.46/177.5 = 92.1% done in 128.1s, 11.0s to go
on time step 16350 (time=163.5), 0.00723712 s/step
Meep progress: 169.03/177.5 = 95.2% done in 132.1s, 6.6s to go
on time step 16908 (time=169.08), 0.00717582 s/step
Meep progress: 174.82/177.5 = 98.5% done in 136.1s, 2.1s to go
on time step 17486 (time=174.86), 0.00693284 s/step
run 0 finished at t = 177.5 (17750 timesteps)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
-----------
Initializing structure...
time for choose_chunkdivision = 0.00101686 s
Working in 2D dimensions.
Computational cell is 35.5 x 10 x 0 with resolution 50
     prism, center = (-7.75,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,-1.125,-10)
          (-12.75,-0.875,-10)
          (-12.75,-0.375,-10)
          (-2.75,-0.125,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-7.75,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,0.125,-10)
          (-12.75,0.375,-10)
          (-12.75,0.875,-10)
          (-2.75,1.125,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (7.75,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (2.75,0.125,-10)
          (2.75,1.125,-10)
          (12.75,0.875,-10)
          (12.75,0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (7.75,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (2.75,-1.125,-10)
          (2.75,-0.125,-10)
          (12.75,-0.375,-10)
          (12.75,-0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (0,0,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-2.75,-1.25,-10)
          (-2.75,1.25,-10)
          (2.75,1.25,-10)
          (2.75,-1.25,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-15.25,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-12.75,-0.375,-10)
          (-12.75,-0.875,-10)
          (-17.75,-0.875,-10)
          (-17.75,-0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (-15.25,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (-12.75,0.875,-10)
          (-12.75,0.375,-10)
          (-17.75,0.375,-10)
          (-17.75,0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (15.25,0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (12.75,0.375,-10)
          (12.75,0.875,-10)
          (17.75,0.875,-10)
          (17.75,0.375,-10)
          dielectric constant epsilon diagonal = (12,12,12)
     prism, center = (15.25,-0.625,0)
          height 20, axis (0,0,1), sidewall angle: 0 radians, 4 vertices:
          (12.75,-0.875,-10)
          (12.75,-0.375,-10)
          (17.75,-0.375,-10)
          (17.75,-0.875,-10)
          dielectric constant epsilon diagonal = (12,12,12)
time for set_epsilon = 7.34026 s
-----------
MPB solved for frequency_1(-1,0,0) = 0.339081 after 9 iters
MPB solved for frequency_1(-2.06483,0,0) = 0.637031 after 7 iters
MPB solved for frequency_1(-2.09396,0,0) = 0.645159 after 12 iters
MPB solved for frequency_1(-2.09396,0,0) = 0.645161 after 1 iters
Meep progress: 4.11/177.5 = 2.3% done in 4.0s, 168.9s to go
on time step 411 (time=4.11), 0.00974018 s/step
Meep progress: 8.620000000000001/177.5 = 4.9% done in 8.0s, 157.0s to go
on time step 862 (time=8.62), 0.00888517 s/step
Meep progress: 13.46/177.5 = 7.6% done in 12.0s, 146.5s to go
on time step 1346 (time=13.46), 0.00827265 s/step
Meep progress: 18.95/177.5 = 10.7% done in 16.0s, 134.0s to go
on time step 1895 (time=18.95), 0.00729013 s/step
Meep progress: 24.37/177.5 = 13.7% done in 20.0s, 125.8s to go
on time step 2437 (time=24.37), 0.0073898 s/step
Meep progress: 29.94/177.5 = 16.9% done in 24.0s, 118.4s to go
on time step 2994 (time=29.94), 0.00718183 s/step
Meep progress: 35.550000000000004/177.5 = 20.0% done in 28.0s, 111.9s to go
on time step 3555 (time=35.55), 0.00713344 s/step
Meep progress: 41.18/177.5 = 23.2% done in 32.0s, 106.0s to go
on time step 4118 (time=41.18), 0.00710646 s/step
Meep progress: 46.77/177.5 = 26.3% done in 36.0s, 100.7s to go
on time step 4677 (time=46.77), 0.00715972 s/step
Meep progress: 52.44/177.5 = 29.5% done in 40.0s, 95.5s to go
on time step 5244 (time=52.44), 0.007058 s/step
Meep progress: 57.75/177.5 = 32.5% done in 44.0s, 91.3s to go
on time step 5775 (time=57.75), 0.0075395 s/step
Meep progress: 63.27/177.5 = 35.6% done in 48.0s, 86.7s to go
on time step 6327 (time=63.27), 0.00725326 s/step
Meep progress: 68.95/177.5 = 38.8% done in 52.0s, 81.9s to go
on time step 6895 (time=68.95), 0.00704646 s/step
Meep progress: 74.44/177.5 = 41.9% done in 56.1s, 77.6s to go
on time step 7444 (time=74.44), 0.00728916 s/step
Meep progress: 79.76/177.5 = 44.9% done in 60.1s, 73.6s to go
on time step 7976 (time=79.76), 0.00752129 s/step
Meep progress: 85.29/177.5 = 48.1% done in 64.1s, 69.3s to go
on time step 8529 (time=85.29), 0.00723825 s/step
Meep progress: 90.96000000000001/177.5 = 51.2% done in 68.1s, 64.8s to go
on time step 9096 (time=90.96), 0.00705638 s/step
Meep progress: 96.57000000000001/177.5 = 54.4% done in 72.1s, 60.4s to go
on time step 9657 (time=96.57), 0.00713214 s/step
Meep progress: 101.8/177.5 = 57.4% done in 76.1s, 56.6s to go
on time step 10180 (time=101.8), 0.00766062 s/step
Meep progress: 106.49000000000001/177.5 = 60.0% done in 80.1s, 53.4s to go
on time step 10649 (time=106.49), 0.00854619 s/step
Meep progress: 111.17/177.5 = 62.6% done in 84.1s, 50.2s to go
on time step 11117 (time=111.17), 0.0085505 s/step
Meep progress: 116.44/177.5 = 65.6% done in 88.1s, 46.2s to go
on time step 11644 (time=116.44), 0.00760126 s/step
Meep progress: 121.65/177.5 = 68.5% done in 92.1s, 42.3s to go
on time step 12165 (time=121.65), 0.00767938 s/step
Meep progress: 127.23/177.5 = 71.7% done in 96.1s, 38.0s to go
on time step 12724 (time=127.24), 0.00716963 s/step
Meep progress: 132.47/177.5 = 74.6% done in 100.1s, 34.0s to go
on time step 13248 (time=132.48), 0.00764434 s/step
Meep progress: 137.48/177.5 = 77.5% done in 104.1s, 30.3s to go
on time step 13749 (time=137.49), 0.00798444 s/step
Meep progress: 142.66/177.5 = 80.4% done in 108.1s, 26.4s to go
on time step 14267 (time=142.67), 0.00772529 s/step
Meep progress: 147.95000000000002/177.5 = 83.4% done in 112.1s, 22.4s to go
on time step 14797 (time=147.97), 0.00755637 s/step
Meep progress: 153.5/177.5 = 86.5% done in 116.1s, 18.2s to go
on time step 15353 (time=153.53), 0.00720376 s/step
Meep progress: 159.11/177.5 = 89.6% done in 120.1s, 13.9s to go
on time step 15914 (time=159.14), 0.00713629 s/step
Meep progress: 164.72/177.5 = 92.8% done in 124.1s, 9.6s to go
on time step 16475 (time=164.75), 0.00713398 s/step
Meep progress: 170.33/177.5 = 96.0% done in 128.1s, 5.4s to go
on time step 17036 (time=170.36), 0.00713501 s/step
Meep progress: 175.41/177.5 = 98.8% done in 132.1s, 1.6s to go
on time step 17545 (time=175.45), 0.00786883 s/step
run 0 finished at t = 177.5 (17750 timesteps)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
MPB solved for frequency_1(2.2349,0,0) = 0.685305 after 22 iters
MPB solved for frequency_1(2.0913,0,0) = 0.645202 after 7 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
MPB solved for frequency_1(2.09116,0,0) = 0.645161 after 1 iters
Dominant planewave for band 1: (2.091156,-0.000000,0.000000)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;S-Params:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPorts</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">1: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">2: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">3: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">4: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transmission:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPorts</span><span class="p">):</span>
    <span class="n">trans1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">trans2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">trans3</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">trans4</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.6f}</span><span class="se">\t</span><span class="si">{:.6f}</span><span class="se">\t</span><span class="si">{:.6f}</span><span class="se">\t</span><span class="si">{:.6f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trans1</span><span class="p">,</span> <span class="n">trans2</span><span class="p">,</span> <span class="n">trans3</span><span class="p">,</span> <span class="n">trans4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>S-Params:
S11: (2.0738370913871975+7.487298912496227j)	S12: (0.10267036521243923+0.3541789713902988j)	S13: (1.8619032659570205+0.7196380954680456j)	S14: (-1.2433181310266084-5.965356796804991j)
S21: (0.10267041899090042+0.3541789482234169j)	S22: (2.0738370289807277+7.487298838505997j)	S23: (-1.2433182903040616-5.965357337594194j)	S24: (1.8619043589601958+0.7196368087266033j)
S31: (1.8618449429249888+0.7178469664410644j)	S32: (-1.243333272338555-5.965300181420933j)	S33: (2.073681163723706+7.48719435122483j)	S34: (0.10283168723619183+0.35410857505000864j)
S41: (-1.2433332729747222-5.965300184431854j)	S42: (1.8618436482730067+0.7178472161916487j)	S43: (0.10283182573003818+0.35410861869374605j)	S44: (2.0736811497999605+7.487194287317847j)
Transmission:
100.000000	0.225287	6.601281	61.515984
0.225287	100.000000	61.515996	6.601285
6.596898	61.517182	100.000000	0.225267
61.517183	6.596890	0.225267	100.000000
</pre></div>
</div>
</div>
</div>
<p>Above, we can see all of the S-parameters from the simulations, and we can verify that the S-parameter are in fact the same for every port, which is what we expected.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./pages"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By CamachoLab and Google<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>