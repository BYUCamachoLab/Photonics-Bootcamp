
<!DOCTYPE html>

<html data-content_root="" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>Scattering parameters — CamachoLab Photonics Bootcamp</title>
<script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
<!-- Loaded before other Sphinx assets -->
<link href="../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet"/>
<link href="../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet"/>
<link href="../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet"/>
<link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" rel="preload" type="font/woff2"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" rel="stylesheet" type="text/css"/>
<link href="../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
<link href="../_static/copybutton.css" rel="stylesheet" type="text/css"/>
<link href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
<link href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" rel="preload"/>
<link as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" rel="preload"/>
<script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/clipboard.min.js"></script>
<script src="../_static/copybutton.js"></script>
<script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
<script>let toggleHintShow = 'Click to show';</script>
<script>let toggleHintHide = 'Click to hide';</script>
<script>let toggleOpenOnPrint = 'true';</script>
<script src="../_static/togglebutton.js"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
<script src="../_static/design-tabs.js"></script>
<script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
<script async="async" src="../_static/sphinx-thebe.js"></script>
<script>DOCUMENTATION_OPTIONS.pagename = 'pages/scattering_parameters';</script>
<link href="https://byucamacholab.github.io/Photonics-Bootcamp/pages/scattering_parameters.html" rel="canonical"/>
<link href="../_static/favicon-laser.svg" rel="shortcut icon"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="drc.html" rel="next" title="Design rule checks"/>
<link href="compact_models.html" rel="prev" title="Compact models"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
<link href="../_static/styles/chattutor.style.css" rel="stylesheet" type="text/css"/></head>
<body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-default-mode="" data-offset="180">
<a class="skip-link" href="#main-content" id="pst-skip-link">Skip to main content</a>
<div id="pst-scroll-pixel-helper"></div>
<button class="btn rounded-pill" id="pst-back-to-top" type="button">
<i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>
<input class="sidebar-toggle" id="__primary" name="__primary" type="checkbox"/>
<label class="overlay overlay-primary" for="__primary"></label>
<input class="sidebar-toggle" id="__secondary" name="__secondary" type="checkbox"/>
<label class="overlay overlay-secondary" for="__secondary"></label>
<div class="search-button__wrapper">
<div class="search-button__overlay"></div>
<div class="search-button__search-container">
<form action="../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search this book..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
</div>
<header>
<div class="bd-header navbar navbar-expand-lg bd-navbar">
</div>
</header>
<div class="bd-container">
<div class="bd-container__inner bd-page-width">
<div class="bd-sidebar-primary bd-sidebar">
<div class="sidebar-header-items sidebar-primary__section">
</div>
<div class="sidebar-primary-items__start sidebar-primary__section">
<div class="sidebar-primary-item">
<a class="navbar-brand logo" href="../index.html">
<img alt="CamachoLab Photonics Bootcamp - Home" class="logo__image only-light" src="../_static/logo.png"/>
<script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="CamachoLab Photonics Bootcamp - Home"/>`);</script>
</a></div>
<div class="sidebar-primary-item"><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item navbar-nav active">
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Front Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development Environment</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="open_source.html">Open source software</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="software.html">Software</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="git_and_github.html">Git (and GitHub)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vscode.html">Visual Studio Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="klayout.html">KLayout</a></li>
<li class="toctree-l2"><a class="reference internal" href="laboratory_tools.html">Laboratory Tools</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Passive Device Design and Simulation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="photonic_devices.html">What are photonic devices?</a></li>
<li class="toctree-l1"><a class="reference internal" href="layer_stack.html">Defining the layer stack</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="components.html">Components</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="gds_to_meep.html">GDS to Meep</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="waveguides.html">Waveguides</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="waveguides_tir.html">Total Internal Reflection</a></li>
<li class="toctree-l2"><a class="reference internal" href="waveguides_polarization.html">Polarization</a></li>
<li class="toctree-l2"><a class="reference internal" href="ray_optic_model.html">Improving the Ray-optic Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="waveguides_mode_solvers.html">Waveguide modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="waveguides_modelling.html">Modelling Wavegudies</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="passive_components.html">Passive components</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="directional_couplers.html">Directional couplers</a></li>
<li class="toctree-l2"><a class="reference internal" href="y_branch.html">Y-Branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="ring_resonators.html">Ring Resonators</a></li>
<li class="toctree-l2"><a class="reference internal" href="mmis.html">Multimode Interferometers (MMIs)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="optical_io.html">Optical I/O</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="grating_couplers.html">Grating couplers</a></li>
<li class="toctree-l2"><a class="reference internal" href="edge_couplers.html">Edge couplers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="optimization.html">Optimization and inverse design</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="shape_optimization.html">Shape optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="adjoint_optimization.html">Adjoint optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="meep_to_gds.html">Meep to GDS</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="compact_models.html">Compact models</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Scattering parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="drc.html">Design rule checks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Circuit Design and Simulation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pdks.html">Process design kits</a></li>
<li class="toctree-l1"><a class="reference internal" href="mzi.html">Mach-Zehnder interferometers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Active Device Design and Simulation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="advanced_components.html">Advanced Components</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="phase_shifters.html">Phase Shifters</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="phase_shifters_heaters.html">Heaters</a></li>
<li class="toctree-l2"><a class="reference internal" href="phase_shifters_pn.html">PN and PIN Junctions</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Testing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="analyzing_circuits.html">Analyzing circuits</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/BYUCamachoLab/sky130ph">Repository</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/BYUCamachoLab/sky130ph/docs">PDK Documentation</a></li>
</ul>
</div>
</nav></div>
</div>
<div class="sidebar-primary-items__end sidebar-primary__section">
</div>
<div id="rtd-footer-container"></div>
</div>
<main class="bd-main" id="main-content">
<div class="sbt-scroll-pixel-helper"></div>
<div class="bd-content">
<div class="bd-article-container">
<div class="bd-header-article">
<div class="header-article-items header-article__inner">
<div class="header-article-items__start">
<div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" data-bs-placement="bottom" data-bs-toggle="tooltip" for="__primary" title="Toggle primary sidebar">
<span class="fa-solid fa-bars"></span>
</label></div>
</div>
<div class="header-article-items__end">
<div class="header-article-item">
<div class="article-header-buttons">
<div class="dropdown dropdown-launch-buttons">
<button aria-expanded="false" aria-label="Launch interactive content" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fas fa-rocket"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://mybinder.org/v2/gh/BYUCamachoLab/Photonics-Bootcamp/main?urlpath=tree/book/pages/scattering_parameters.ipynb" target="_blank" title="Launch onBinder">
<span class="btn__icon-container">
<img src="../_static/images/logo_binder.svg"/>
</span>
<span class="btn__text-container">Binder</span>
</a>
</li>
<li><a class="btn btn-sm dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://colab.research.google.com/github/BYUCamachoLab/Photonics-Bootcamp/blob/main/book/pages/scattering_parameters.ipynb" target="_blank" title="Launch onColab">
<span class="btn__icon-container">
<img src="../_static/images/logo_colab.png"/>
</span>
<span class="btn__text-container">Colab</span>
</a>
</li>
</ul>
</div>
<div class="dropdown dropdown-source-buttons">
<button aria-expanded="false" aria-label="Source repositories" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fab fa-github"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm btn-source-repository-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://github.com/BYUCamachoLab/Photonics-Bootcamp" target="_blank" title="Source repository">
<span class="btn__icon-container">
<i class="fab fa-github"></i>
</span>
<span class="btn__text-container">Repository</span>
</a>
</li>
<li><a class="btn btn-sm btn-source-edit-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://github.com/BYUCamachoLab/Photonics-Bootcamp/edit/main/book/pages/scattering_parameters.ipynb" target="_blank" title="Suggest edit">
<span class="btn__icon-container">
<i class="fas fa-pencil-alt"></i>
</span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
<li><a class="btn btn-sm btn-source-issues-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://github.com/BYUCamachoLab/Photonics-Bootcamp/issues/new?title=Issue%20on%20page%20%2Fpages/scattering_parameters.html&amp;body=Your%20issue%20content%20here." target="_blank" title="Open an issue">
<span class="btn__icon-container">
<i class="fas fa-lightbulb"></i>
</span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
</ul>
</div>
<div class="dropdown dropdown-download-buttons">
<button aria-expanded="false" aria-label="Download this page" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fas fa-download"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm btn-download-source-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="../_sources/pages/scattering_parameters.ipynb" target="_blank" title="Download source file">
<span class="btn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
<li>
<button class="btn btn-sm btn-download-pdf-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" onclick="window.print()" title="Print to PDF">
<span class="btn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
<button class="btn btn-sm btn-fullscreen-button" data-bs-placement="bottom" data-bs-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="btn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" data-bs-placement="bottom" data-bs-toggle="tooltip" for="__secondary" title="Toggle secondary sidebar">
<span class="fa-solid fa-list"></span>
</label>
</div></div>
</div>
</div>
</div>
<div class="onlyprint" id="jb-print-docs-body">
<h1>Scattering parameters</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-scattering-parameters">What are scattering parameters?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#todo-why-are-s-parameters-useful">TODO: Why are S-Parameters useful?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#todo-demonstration-of-using-simphony-to-simulate-a-circuit-quickly-using-s-parameters">TODO: Demonstration of using simphony to simulate a circuit quickly using s-parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation">How to find S-Parameters for an arbitrary device using a meep simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-import-geometry">Step 1 - Import Geometry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-run-simulation-for-a-single-source">Step 2: Run simulation for a single source</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-run-the-same-simulation-for-each-of-the-other-ports">Step 3: Run the same simulation for each of the other ports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-parameters-across-different-frequencies">S-Parameters across different Frequencies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</nav>
</div>
</div>
</div>
<div id="searchbox"></div>
<article class="bd-article">
<section class="tex2jax_ignore mathjax_ignore" id="scattering-parameters">
<h1>Scattering parameters<a class="headerlink" href="#scattering-parameters" title="Permalink to this heading">#</a></h1>
<section id="what-are-scattering-parameters">
<h2>What are scattering parameters?<a class="headerlink" href="#what-are-scattering-parameters" title="Permalink to this heading">#</a></h2>
<p>Scattering parameters (S-parameters) are values that represent linear characteristics of devices that operate at radio frequencies or higher and are used in both RF electronics and in photonics. For a given photonic device, while knowing the actual shape of the device is useful, what we really care about is how light propagates through it. S-Parameters give us this necessary information by telling us how much light will exit a given port based on how much light was inserted and where.</p>
<p>For a device with N ports, there will be N<sup>2</sup> s-parameters, which are normally organized in an NxN matrix, ofen called the Scatter Matrix. Each S-parameter is a complex number that gives the magnitude and phase of the wave exiting the exit port given the wave entering the input port. The notation for S-Parameters is S<sub>(output port)(input port)</sub>. So, S<sub>13</sub> will be for the light entering port 3 and exiting port 1</p>
</section>
<section id="todo-why-are-s-parameters-useful">
<h2>TODO: Why are S-Parameters useful?<a class="headerlink" href="#todo-why-are-s-parameters-useful" title="Permalink to this heading">#</a></h2>
<p>Scattering parameters allow us to characterize the bechavior of photonic circuits in a comprehensive way. They describe the relationship between a photonic circuit’s input signals and its output signals in terms of power, phase, and impedance. They allow us to understand how various elements within a photonic circuit interact.</p>
<p>When we know the scattering parameters of elements within a photonic circuit, we can use simulation software and modelling tools to design, simulate, and test circuits according to desired performance metrics. These tools enable us to optimize circuit designs before the fabrication process, and validate the fabrication process after they’ve been manufactured.</p>
</section>
<section id="todo-demonstration-of-using-simphony-to-simulate-a-circuit-quickly-using-s-parameters">
<h2>TODO: Demonstration of using simphony to simulate a circuit quickly using s-parameters<a class="headerlink" href="#todo-demonstration-of-using-simphony-to-simulate-a-circuit-quickly-using-s-parameters" title="Permalink to this heading">#</a></h2>
</section>
<section id="how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation">
<h2>How to find S-Parameters for an arbitrary device using a meep simulation<a class="headerlink" href="#how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation" title="Permalink to this heading">#</a></h2>
<p>In this section we’ll demonstrate how to find the s-params for any device using a meep simulation. We’ll show both 2D and 3D simulations, but keep in mind that 2D s-params are not very accurate. We’ll run through the steps using gdsfactory’s default 2x2 mmi, and explain on the way how the principles can be applied to any component. There are other ways to find s-parameters, and another method is shown on the <a class="reference internal" href="gds_to_meep.html"><span class="doc std std-doc">Gds To Meep</span></a> page</p>
<section id="step-1-import-geometry">
<h3>Step 1 - Import Geometry<a class="headerlink" href="#step-1-import-geometry" title="Permalink to this heading">#</a></h3>
<p>For our simulation, it makes life easy if we add all of our sources and detectors into our gds before we import it into meep. For this tutorial I have already done this. For your simulations, you can modify your gds file directly in Klayout if you like a GUI, or you can use gdsfactory itself. If you like, you can also use meep to do the same thing, but I won’t be showing how to do that here. This tutorial is adapted from the <a class="reference external" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/GDSII_Import/">GDSII Import</a> tutorial on the meep documentation</p>
<p>Here is a picture of the gds we will be using.</p>
<p><img alt="Image of splitter file" src="https://raw.githubusercontent.com/BYUCamachoLab/Photonics-Bootcamp/main/book/images/Notebook_Images/mmi2x2_gds_with_ports.png"/></p>
<p>I’ve added a box around the entire component (in purple) which will become the simulation region, and 8 lines, 2 on each end that will become the sources and detectors. I also added straight waveguides on the ports of the gdsfactory mmi so that my ports could be exactly where the light would enter and exit the component in an actual circuit. My sources are then slightly outside the mmi, in the waveguides.</p>
<p>So, now that we have a gds, lets import it into meep!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">meep</span> <span class="k">as</span> <span class="nn">mp</span> 
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="c1">#import math</span>
</pre></div>
</div>
</div>
</div>
<p>Next we’ll define a whole bunch of variables so our code is more readable down the line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="mi">40</span> <span class="c1"># the resolution of the simulation in pixels/um</span>
<span class="n">three_d</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Turn this to false for a 2D simulation</span>
<span class="k">if</span> <span class="n">three_d</span><span class="p">:</span> <span class="c1"># If three_d, reduce the resolution</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">/</span><span class="mi">2</span>

<span class="n">gds_file</span> <span class="o">=</span> <span class="s2">"/home/jkart/Work/Photonics-Bootcamp/Photonics-Bootcamp/book/images/mmi2x2.gds"</span> <span class="c1"># The name of our gds file</span>

<span class="c1"># Here we define the layer numbers for each part of our gds</span>
<span class="n">geometry_L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">cell_L</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">port1_L</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">port2_L</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">port3_L</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">port4_L</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">source1_L</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">source2_L</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">source3_L</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">source4_L</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># The Parameters for the frequencies we'll be using</span>
<span class="n">lcen</span> <span class="o">=</span> <span class="mf">1.55</span> <span class="c1"># Center wavelength</span>
<span class="n">fcen</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">lcen</span> <span class="c1"># Center frequency</span>
<span class="n">df</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">fcen</span> <span class="c1"># Frequency Diameter</span>

<span class="c1"># The thickness of each material in our simulation (only used in 3D simulations)</span>
<span class="n">t_oxide</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">t_Si</span> <span class="o">=</span> <span class="mf">0.22</span>
<span class="n">t_air</span> <span class="o">=</span> <span class="mf">0.78</span>

<span class="n">dpml</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Diameter of perfectly matched layers</span>
<span class="n">cell_thickness</span> <span class="o">=</span> <span class="n">dpml</span> <span class="o">+</span> <span class="n">t_oxide</span> <span class="o">+</span> <span class="n">t_Si</span> <span class="o">+</span> <span class="n">t_air</span> <span class="o">+</span> <span class="n">dpml</span> <span class="c1"># Cell thickness</span>

<span class="c1"># The materials we will have in our simulation, silicon and SiO2</span>
<span class="n">oxide</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">2.25</span><span class="p">)</span>
<span class="n">silicon</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Sets the min and max values for the cell and the silicon. Our simulation will be centered at y=0</span>
<span class="n">cell_zmax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">cell_thickness</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="mi">0</span>
<span class="n">cell_zmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">cell_thickness</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="mi">0</span>
<span class="n">si_zmax</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">t_Si</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="mi">10</span> <span class="c1"># In a 2D simulation, the geometry still has to have a thickness or it won't show up</span>
<span class="n">si_zmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">t_Si</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="o">-</span><span class="mi">10</span>

<span class="c1"># Create a 2D array to hold the S-Parameters for the device</span>
<span class="n">numPorts</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># The number of ports, also the size of our array</span>
<span class="c1"># s_params = [[0 for i in range(numPorts)] for j in range(numPorts)]</span>
<span class="c1"># input_params = [0 for i in range(numPorts)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we’ll import our geometries from the gds file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">###################################################</span>
<span class="c1"># Now we actually import the geometry</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_prisms</span><span class="p">(</span><span class="n">silicon</span><span class="p">,</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">geometry_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">si_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">si_zmin</span><span class="p">)</span> <span class="c1"># Gets the geometry of the mmi</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">cell_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span> <span class="c1"># cell geometry. We use mp.GDSII_vol() instead of mp.GDSII_prims() because they return different types</span>
<span class="n">port1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">port1_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span> <span class="c1"># Port geometry</span>
<span class="n">port2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">port2_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>
<span class="n">port3</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">port3_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>
<span class="n">port4</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">port4_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>
<span class="n">source1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">source1_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span> <span class="c1"># Source Geometry</span>
<span class="n">source2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">source2_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>
<span class="n">source3</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">source3_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>
<span class="n">source4</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GDSII_vol</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">gds_file</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">source4_L</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">cell_zmax</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">cell_zmin</span><span class="p">)</span>


<span class="k">if</span> <span class="n">three_d</span><span class="p">:</span> <span class="c1"># Sets up the oxide cladding for a three d simulation (Not used in a 2D simulation)</span>
    <span class="n">oxide_center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">z</span><span class="o">=-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">t_oxide</span><span class="p">)</span>
    <span class="n">oxide_size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cell</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">t_oxide</span><span class="p">)</span>
    <span class="n">oxide_layer</span> <span class="o">=</span> <span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="n">material</span><span class="o">=</span><span class="n">oxide</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">oxide_center</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">oxide_size</span><span class="p">)]</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="o">+</span> <span class="n">oxide_layer</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2-run-simulation-for-a-single-source">
<h3>Step 2: Run simulation for a single source<a class="headerlink" href="#step-2-run-simulation-for-a-single-source" title="Permalink to this heading">#</a></h3>
<p>In order to find all the S-Parameters for a device, we have to run a simulation for each port. Each time we switch where the source is, and then get the S-parameters from that port. So, for this component, I’ll run 4 simulations, each time injecting the light into a different port. Then I’ll calculate the S-parameters between the port that has the light, and every other port.</p>
<p>Because I added geometry for the sources in the gds, we just have to input that geometry into the source instead of constructing it in meep.
TODO: Explain briefly why we use the eig_parity we do, and what the eig_band and eig_match_freq</p>
<p>Once we define the source in meep, we can create a simulation object by simply passing all of the necessary parts into the contructor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the first source for the simulation. I'll start with port1 (the lower left)</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">source1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">source1</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

    <span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Create Simulation</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="c1"># The resolution, defined further up</span>
    <span class="n">cell_size</span><span class="o">=</span><span class="n">cell</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># The cell size, taken from the gds</span>
    <span class="n">boundary_layers</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">dpml</span><span class="p">)],</span> <span class="c1"># the perfectly matched layers, with a diameter as defined above</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="n">sources</span><span class="p">,</span> <span class="c1"># The source(s) we just defined</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="c1"># The geometry, from above</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<p>After creating the simulation object, we can add mode monitors at each of the ports. These will read how much light comes in/out of each port.</p>
<p>Now that our simulation is completely set up for the first source, I can plot it to make sure everything looks right before running the simulation. We do that using the plot2D() method of the simulation object.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adds mode monitors at each of the ports to track the energy that goes in or out, then adds them to a list</span>
<span class="n">modeMonitors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">modeMonitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port1</span><span class="p">)))</span> <span class="c1"># Adds mode monitor for the frequency fcen, at only that frequency</span>
<span class="n">modeMonitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port2</span><span class="p">)))</span>
<span class="n">modeMonitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port3</span><span class="p">)))</span>
<span class="n">modeMonitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port4</span><span class="p">)))</span>

<span class="c1"># Plot the simulation</span>
<span class="n">sim</span><span class="o">.</span><span class="n">plot2D</span><span class="p">()</span> <span class="c1"># No parameters are needed for a 2D simulation. </span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>As we see from the output of sim.plot2D(), our simulation is set up correctly. The red is our source, the blue are our 4 mode monitors, an the black is the geometry. We are ready to run the simulation! Actually running the simulation is the most computationally intense part of this, so it may take some time. The until_after_sources parameter for sim.run() means the run the simulation until 100 meep time units after the sources have turned off. This makes sure the all of the light has time to propagate through the mmi.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Runs the simulation</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until_after_sources</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Now that our simulation has been run, we’ll quickly compute the s-parameters, store them in our array, and print them out. The function sim.get_eigenmode_coefficients() returns an array that holds the parameters for every mode, every frequency, and in the forward and backward direction. In our simulation we only simulated the fundamental TE mode and at only our center frequency. For most applications, only the fundamental TE mode matters, but often we do want to see how the S-parameters change with frequency. To do that, simply change the df and nfreq parameters for the mode monitors. However, in our simulation we do care about the direction. In our simulation, light will go in port 1 going forward (towards positive X) and exit ports 3 and 4 in the same direction, but any light exiting port 1 and 2 will be going backwards (towards negative X). So, we change the alpha to be (0,0,1) for port 1 and 2. The 1 in the third spot indicates the backward propagating light. We’ll also see how much light is inserted at port 1 going forward.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span> <span class="c1"># This array holds the values for forwards and backward propagation for each soure. The 5th number is for the total input</span>
<span class="c1"># Finds the S parameters</span>
<span class="n">input_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modeMonitors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]]</span> <span class="c1"># This is the amount of light from the source that enters the device</span>
<span class="n">port1_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modeMonitors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">port2_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modeMonitors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">port3_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modeMonitors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">port4_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modeMonitors</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]]</span>
<span class="c1"># Store the S parameters in s_params</span>
<span class="n">s_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">port1_coeff</span><span class="p">,</span> <span class="n">port2_coeff</span><span class="p">,</span> <span class="n">port3_coeff</span><span class="p">,</span> <span class="n">port4_coeff</span><span class="p">]</span>
<span class="n">input_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_coeff</span>


<span class="c1"># Prints out the S parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"S params: Port1(Lower Left, S11): </span><span class="si">{:.6f}</span><span class="s2">  Port2(Upper Left, S12): </span><span class="si">{:.6f}</span><span class="s2">  Port3(Upper Right, S13): </span><span class="si">{:.6f}</span><span class="s2">  Port4(Lower Right, S14): </span><span class="si">{:.6f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port1_coeff</span><span class="p">,</span> <span class="n">port2_coeff</span><span class="p">,</span> <span class="n">port3_coeff</span><span class="p">,</span> <span class="n">port4_coeff</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<p>Just for fun, we’ll also compute and print the transmittance through each port and the total insertion loss. We won’t do this with the other ports, but it’s a good exercise here.</p>
<p>We find that this component is actually terrible and would never be used in an actual photonic design. Almost a third of the light is lost, and the light that isn’t lost is not split in any specific ratio. Fortunately, it was never meant to be used, and just exists as an example of the basic shape of an mmi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculates the transmittance based off of the S parameters</span>
<span class="n">port1_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port1_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">input_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">port2_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port2_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">input_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">port3_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port3_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">input_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">port4_trans</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">port4_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">input_coeff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="c1"># Calculates the Insertion loss as a percent and in dB</span>
<span class="n">insertionLoss</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">port2_trans</span> <span class="o">+</span> <span class="n">port3_trans</span> <span class="o">+</span> <span class="n">port4_trans</span><span class="p">)</span>
<span class="n">insertionLoss_dB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">insertionLoss</span><span class="p">)</span> 

<span class="c1"># Prints the Transmittance</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Transmittance/Reflectance: Port1: </span><span class="si">{:.6f}</span><span class="s2">% Port2: </span><span class="si">{:.6f}</span><span class="s2">%, Port3: </span><span class="si">{:.6f}</span><span class="s2">%, Port4: </span><span class="si">{:.6f}</span><span class="s2">%"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port1_trans</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">port2_trans</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">port3_trans</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">port4_trans</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Insertion Loss: </span><span class="si">{:.6f}</span><span class="s2">% -&gt; </span><span class="si">{:.6f}</span><span class="s2">db"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">insertionLoss</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">insertionLoss_dB</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, before we move on to the next step, we’ll run the simulation again and create a plot of the steady state of the mmi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reset the simulation in order to run it again and visulaize the fields</span>
<span class="n">sim</span><span class="o">.</span><span class="n">reset_meep</span><span class="p">()</span>

<span class="c1"># Create a continuous source</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
        <span class="n">src</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">ContinuousSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
        <span class="n">size</span><span class="o">=</span><span class="n">source1</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="n">source1</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
        <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
        <span class="n">eig_match_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Sets up the simulation again</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
    <span class="n">cell_size</span><span class="o">=</span><span class="n">cell</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
    <span class="n">boundary_layers</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">dpml</span><span class="p">)],</span>
    <span class="n">sources</span><span class="o">=</span><span class="n">sources</span><span class="p">,</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Runs the simulation for a long time to ensure that the fields have reached a steady state</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">until</span><span class="o">=</span><span class="mi">300</span>
<span class="p">)</span>

<span class="c1"># Gets data</span>
<span class="n">eps_data</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">()</span> <span class="c1"># Epsilon Data / The Geometry / An array that holds what materials are where</span>
<span class="n">ez_data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">get_efield_z</span><span class="p">())</span> <span class="c1"># Values for the component of the E-field in the z direction (in/out of screen)</span>

<span class="c1"># Creates the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">eps_data</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">"spline36"</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"binary"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ez_data</span><span class="p">)),</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s2">"spline36"</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">"RdBu"</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">"off"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-3-run-the-same-simulation-for-each-of-the-other-ports">
<h3>Step 3: Run the same simulation for each of the other ports<a class="headerlink" href="#step-3-run-the-same-simulation-for-each-of-the-other-ports" title="Permalink to this heading">#</a></h3>
<p>Now, all that’s left to do is to run the simulation for each source. Here, I’ll use a for loop to run the other three simulations. We could have done this for all four, but hopefully this makes the code make more sense.</p>
<p>For the sources going into port 3 and 4, we have to specify that the light will be propagating backwards. Below, I’ve done this by setting the direction to mp.NO_DIRECTION and using the eig_kpoint parameter to specify the direction. You can use this same method to launch sources in any direction.</p>
<p>It should be noted, that since the 2x2 mmi we are using is symmetrical across both the x and y axies, the S-parameters should be the same for all of the other ports. But for the sake of demonstration, we’ll simulate all of them. Then at then end we can check to see the the S-parameters are actually the same.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the rest of the sources for the simulation.</span>
<span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">source2</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">source2</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

    <span class="p">),</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">source3</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">source3</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">eig_kpoint</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_DIRECTION</span>

    <span class="p">),</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">EigenModeSource</span><span class="p">(</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">GaussianSource</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">df</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">source4</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># Here we input the geometry for our first source</span>
            <span class="n">center</span><span class="o">=</span><span class="n">source4</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
            <span class="n">eig_band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">eig_parity</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">,</span>
            <span class="n">eig_match_freq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">eig_kpoint</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">NO_DIRECTION</span>

    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPorts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">sources</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">sim</span><span class="o">.</span><span class="n">reset_meep</span><span class="p">()</span> <span class="c1"># resets everything</span>

    <span class="c1"># Create Simulation</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">resolution</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="c1"># The resolution, defined further up</span>
    <span class="n">cell_size</span><span class="o">=</span><span class="n">cell</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="c1"># The cell size, taken from the gds</span>
    <span class="n">boundary_layers</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">dpml</span><span class="p">)],</span> <span class="c1"># the perfectly matched layers, with a diameter as defined above</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="n">source</span><span class="p">,</span> <span class="c1"># The source(s) we just defined</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="c1"># The geometry, from above</span>
    <span class="p">)</span>
    
    <span class="c1"># Adds mode monitors at each of the ports to track the energy that goes in or out</span>
    <span class="n">modeMonitors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modeMonitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port1</span><span class="p">)))</span>
    <span class="n">modeMonitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port2</span><span class="p">)))</span>
    <span class="n">modeMonitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port3</span><span class="p">)))</span>
    <span class="n">modeMonitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">add_mode_monitor</span><span class="p">(</span><span class="n">fcen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">ModeRegion</span><span class="p">(</span><span class="n">volume</span><span class="o">=</span><span class="n">port4</span><span class="p">)))</span>

    <span class="c1"># Runs the simulation</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until_after_sources</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1">#############################################################</span>
    <span class="c1"># Finds the S parameters</span>
    <span class="n">port1_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modeMonitors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">port2_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modeMonitors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">port3_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modeMonitors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">port4_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modeMonitors</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]]</span>
    <span class="n">input_coeff</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_eigenmode_coefficients</span><span class="p">(</span><span class="n">modeMonitors</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eig_parity</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">NO_PARITY</span> <span class="k">if</span> <span class="n">three_d</span> <span class="k">else</span> <span class="n">mp</span><span class="o">.</span><span class="n">EVEN_Y</span> <span class="o">+</span> <span class="n">mp</span><span class="o">.</span><span class="n">ODD_Z</span><span class="p">)</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">]]</span> <span class="c1"># This is the total amount of light that entered the devie</span>

    <span class="c1"># Store the S parameters in s_params</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">i</span> 
    <span class="n">s_params</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">port1_coeff</span><span class="p">,</span> <span class="n">port2_coeff</span><span class="p">,</span> <span class="n">port3_coeff</span><span class="p">,</span> <span class="n">port4_coeff</span><span class="p">]</span>
    <span class="n">input_params</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_coeff</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"S-Params:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPorts</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">1: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">2: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">3: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">S</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">4: </span><span class="si">{</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Input S-Params"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"S1: </span><span class="si">{</span><span class="n">input_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">S2: </span><span class="si">{</span><span class="n">input_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">S3: </span><span class="si">{</span><span class="n">input_params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">S4: </span><span class="si">{</span><span class="n">input_params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">"Transmission:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPorts</span><span class="p">):</span>
    <span class="n">input_power</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">input_params</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">trans1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">input_power</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">trans2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">input_power</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">trans3</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">input_power</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">trans4</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_params</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">input_power</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">{:.6f}</span><span class="se">\t</span><span class="si">{:.6f}</span><span class="se">\t</span><span class="si">{:.6f}</span><span class="se">\t</span><span class="si">{:.6f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trans1</span><span class="p">,</span> <span class="n">trans2</span><span class="p">,</span> <span class="n">trans3</span><span class="p">,</span> <span class="n">trans4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">the</span> <span class="n">Kernel</span><span class="o">.</span> 

<span class="n">Kernel</span> <span class="n">Python</span> <span class="mf">3.9.6</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">usable</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">Jupyter</span> <span class="n">output</span> <span class="n">tab</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span> 

<span class="n">View</span> <span class="n">Jupyter</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">'command:jupyter.viewOutput'</span><span class="o">&gt;</span><span class="n">log</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<p>Above, we can see all of the S-parameters from the simulations, and we can verify that the S-parameters are in fact the same for every port, which is what we expected. We also calculated the transmission which is also the same no matter what port we use.</p>
</section>
<section id="s-parameters-across-different-frequencies">
<h3>S-Parameters across different Frequencies<a class="headerlink" href="#s-parameters-across-different-frequencies" title="Permalink to this heading">#</a></h3>
<p>For most applications, you’ll want to know the S-parameters across a range of frequencies. This can be done using the simulations created here. When we get the S-parameters using the sim.get_eigenmode_coefficients().alpha[] we get a matrix. The first entry in the matrix specifies the wavelength. For brevities sake, we won’t show that here, but a good exercise would be to find and plot the s-paramters across a range of frequencies for the component shown here.</p>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://www.mathworks.com/discovery/s-parameter.html">MathWorks: What are S-Parameters</a></p>
<p><a class="reference external" href="https://docs.lucedaphotonics.com/guides/caphe_models_frequency/scatter_matrix">Luceda: Scatter matrix</a></p>
<p><a class="reference external" href="https://www.microwaves101.com/encyclopedias/s-parameters">Microwaves101: S-Parameters</a></p>
<p><a class="reference external" href="https://www.youtube.com/watch?v=-Pi0UbErHTY">Youtube: Understanding S-Parameters</a></p>
</section>
</section>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./pages"
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
</article>
<footer class="prev-next-footer">
<div class="prev-next-area">
<a class="left-prev" href="compact_models.html" title="previous page">
<i class="fa-solid fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Compact models</p>
</div>
</a>
<a class="right-next" href="drc.html" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">Design rule checks</p>
</div>
<i class="fa-solid fa-angle-right"></i>
</a>
</div>
</footer>
</div>
<div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">
<div class="sidebar-secondary-item">
<div class="page-toc tocsection onthispage">
<i class="fa-solid fa-list"></i> Contents
  </div>
<nav class="bd-toc-nav page-toc">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-scattering-parameters">What are scattering parameters?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#todo-why-are-s-parameters-useful">TODO: Why are S-Parameters useful?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#todo-demonstration-of-using-simphony-to-simulate-a-circuit-quickly-using-s-parameters">TODO: Demonstration of using simphony to simulate a circuit quickly using s-parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-find-s-parameters-for-an-arbitrary-device-using-a-meep-simulation">How to find S-Parameters for an arbitrary device using a meep simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-import-geometry">Step 1 - Import Geometry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-run-simulation-for-a-single-source">Step 2: Run simulation for a single source</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-run-the-same-simulation-for-each-of-the-other-ports">Step 3: Run the same simulation for each of the other ports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#s-parameters-across-different-frequencies">S-Parameters across different Frequencies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</nav></div>
</div></div>
</div>
<footer class="bd-footer-content">
<div class="bd-footer-content__inner container">
<div class="footer-item">
<p class="component-author">
By CamachoLab and Google
</p>
</div>
<div class="footer-item">
<p class="copyright">
    
      © Copyright 2023.
      <br/>
</p>
</div>
<div class="footer-item">
</div>
<div class="footer-item">
</div>
</div>
</footer>
</main>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>
<footer class="bd-footer">
</footer>
<script src="../_static/scripts/chattutor.config.js"></script><script src="../_static/scripts/chattutor.min.js" type="module"></script></body>
</html>